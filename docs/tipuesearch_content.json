{"pages":[{"url":"https://brillliantz.github.io/MySite/test/test.html","text":"this new post hello, WOrld! let's rock: $$ \\frac{\\sum_1&#94;{+inf} n+1}{x&#94;{2t+1}} $$ if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) { var align = \"center\", indent = \"0em\", linebreak = \"false\"; if (false) { align = (screen.width < 768) ? \"left\" : align; indent = (screen.width < 768) ? \"0em\" : indent; linebreak = (screen.width < 768) ? 'true' : linebreak; } var mathjaxscript = document.createElement('script'); var location_protocol = (false) ? 'https' : document.location.protocol; if (location_protocol !== 'http' && location_protocol !== 'https') location_protocol = 'https:'; mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#'; mathjaxscript.type = 'text/javascript'; mathjaxscript.src = location_protocol + '//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'; mathjaxscript[(window.opera ? \"innerHTML\" : \"text\")] = \"MathJax.Hub.Config({\" + \" config: ['MMLorHTML.js'],\" + \" TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },\" + \" jax: ['input/TeX','input/MathML','output/HTML-CSS'],\" + \" extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js'],\" + \" displayAlign: '\"+ align +\"',\" + \" displayIndent: '\"+ indent +\"',\" + \" showMathMenu: true,\" + \" messageStyle: 'normal',\" + \" tex2jax: { \" + \" inlineMath: [ ['\\\\\\\\(','\\\\\\\\)'] ], \" + \" displayMath: [ ['$$','$$'] ],\" + \" processEscapes: true,\" + \" preview: 'TeX',\" + \" }, \" + \" 'HTML-CSS': { \" + \" styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} },\" + \" linebreaks: { automatic: \"+ linebreak +\", width: '90% container' },\" + \" }, \" + \"}); \" + \"if ('default' !== 'default') {\" + \"MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {\" + \"var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;\" + \"VARIANT['normal'].fonts.unshift('MathJax_default');\" + \"VARIANT['bold'].fonts.unshift('MathJax_default-bold');\" + \"VARIANT['italic'].fonts.unshift('MathJax_default-italic');\" + \"VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');\" + \"});\" + \"MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {\" + \"var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;\" + \"VARIANT['normal'].fonts.unshift('MathJax_default');\" + \"VARIANT['bold'].fonts.unshift('MathJax_default-bold');\" + \"VARIANT['italic'].fonts.unshift('MathJax_default-italic');\" + \"VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');\" + \"});\" + \"}\"; (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript); }","tags":"TEST","title":"Feature tests"},{"url":"https://brillliantz.github.io/MySite/thoughts/SocialPractice.html","text":"背景介绍 我们以以洛阳水席、牡丹瓷、河洛大鼓这三个分属饮食、工艺品、文艺三个不同方面的洛阳传统文化的代表物入手，调研在当前社会经济背景下，洛阳传统文化产业的发展状况和瓶颈，研讨发展方向，给出科学的建议以寻求突破发展瓶颈。挖掘文化价值，弘扬大国工匠精神。与地方政府，媒体合作，共谋家乡腾飞。 1 实践内容 我们采访了牡丹瓷的创始人李学武先生，他用了三年时间研发开拓出市场，而如今李学武牡丹瓷已经成为国家文化产业示范基地。 李学武牡丹瓷 的灵感来源于 唐三彩 和 唐白瓷 ，专门的研发团队每年都从美术学院等相关院校招新以融入新鲜血液。从哑光到亮光，从空底盘到实底盘又到手工彩绘的底盘，尽管一直被仿造，但李先生的牡丹瓷由于不断的研发创新得以立于不败之地。 李学武先生告诉我们: 牡丹瓷的用途及其广泛，上可作为国礼，下可做为居家装饰良品。作为国礼互赠的牡丹瓷有专门的生产车间，其外观华贵，细致精美，价位较高，最高大概三万元左右。而稍平价的牡丹瓷中比较有名的有\"中国妞妞\"和\"新三彩\"。其中\"中国妞妞\"被称作东方的芭比娃娃，而\"新三彩\"则用牡丹瓷的工艺对原有的唐三彩进行再创造，相较于唐三彩更加符合现代审美。 在收获巨大成功的同时，李学武先生坦言目前自己的公司也存在着一些\"痼疾\"。李先生提到，牡丹瓷在出口方面具有一定的局限性，仅靠赠送等被外国友人收藏，而并没有专门的出口渠道。同时，牡丹瓷在宣传方面也需加强，虽每年有展销会之类的但由于展销会和销售点基本只在一线城市，牡丹瓷的知名度在很多地区并不高。 2 结果分析 掘取传统文化符号，加之以现代工业的运作流程——文化产业成于\"雅\"。牡丹和陶瓷这两个代表华夏文明的元素巧妙地结合成了美轮美奂的工艺品，其所蕴含的文化价值转化为商业价值，并在这种转化中实现自身的传承、发扬与创新。由此可见，传统文化不仅仅是积淀在历史中的、形而上的存在，对于它，我们大有文章可做。在现代社会，有意识地寻根溯源、探索中国传统文化的人们越来越多，文化所赋予我们的商机使得这片市场一片光明。 传承上： 洛阳牡丹瓷继承了唐三彩、唐白瓷等传统工艺品的审美特点和技术工艺；同时糅合了现代人的审美取向，并依托于\"洛阳牡丹\"这一极具地域特征的文化符号使之成为洛阳具有文化底蕴和时代特征的新兴艺术品.但牡丹瓷在全国范围内的知名度还不是很高，距离成为像景德镇陶瓷、宜兴紫砂壶一样的地域符号，仍有不小的距离. 工艺上： 洛阳牡丹瓷体现了洛阳这一文化都会高超的工艺水平.对釉色和彩绘的把握极为细致，使工艺品具有极为生动而逼真的审美特质.尽管如此，牡丹瓷工艺仍不断进步，无论是在瓷体光泽的处理上还是在瓷体底盘的美化上，都有长足的进展.但与此同时，洛阳牡丹瓷仍有清洗保养困难等不利于收藏的弊端，亟待生产者进行行之有效的改进 市场上： 洛阳牡丹瓷在洛阳本地获得了较高知名度后，已有实力进行车间化生产，同时通过展销会等手段，已经在某些一线城市站稳了脚跟.同时牡丹瓷既具有可以被当作国礼的高端产品，也具有\"中国妞妞\"这一能和芭比娃娃相提并论的极具东方特质的小型产品，为大众所喜闻乐见.但牡丹瓷在二三线城市的宣传几乎仍是空白，出口渠道也尚未打开，这需要生产厂家和当地政府共同努力，为牡丹瓷铺就一条宣传、销售的坦途. 政策上： 牡丹瓷从最初的构思到今天的大规模生产，得到了洛阳当地政府的有力支持，从经济上到文化上，都受到大力扶持.但牡丹瓷的技术不断被模仿，说明当地政府对知识产权的保护还不够到位，这仍旧需要政府相关职能部门和牡丹瓷工艺的所有者共同努力。 将传统工艺品的文化价值，转化为商业价值并借此发扬光大文化价值，并不仅仅局限于工艺品本身这样一种形式，在媒体互联网如此发达的当代，这种转化与发扬应当是多元的，可以借助电影、独立游戏与应用等其他文化领域来实现。具体来说，电影的导演可以在相关电影中有意识地插入这些牡丹瓷等这些传统文化元素，让其成为一些镜头的重要组成部分，如果应用得当，不仅使电影增色，也弘扬了传统文化，并借住电影将其推向国际市场。另一可行的具体做法是制作相关的独立游戏或者介绍牡丹瓷的应用，已经有团队通过这一方法取得了重大的成果。在 iOS 上有一款应用《 卯榫 》，借住现代技术，将卯榫这一传统工艺立体地呈现给了大众，取得了巨大的成功。去年苹果 CEO Tim Cook 访华时，还亲自拜访了制作这一应用的团队，可见这种形式不仅仅能够在国内推广传统文化，更能将传统文化推向世界，并且取得了大量的关注度。这样做的好处是不言而喻的。一方面，可以借助文学、电影、应用、游戏这些受众广的领域来更好地、更有效地、更广泛地推广传统文化；另一方面，在文学、电影、应用、游戏这些领域，中国的本土团队，要想能够在国际上具有核心竞争力，要想能处于到独树一帜的创新地位，其中一个很重要的方式，就是能够将像牡丹、陶瓷这种具有中国传统特色的文化元素以一种世界都能够接受的方法融入到自己作品，让世界能够感受到我们的作品是与众不同的，是具有艺术价值的，这样我们的文学、电影等文化领域才能够屹立于世界文化之中。这是一种传统工艺品与现当代其他文化形式相互交融，相互促进，共同发展的发展模式，不仅仅推动了传统工艺品的文化价值向商业价值的转化和其的发扬光大，还能够促进其他文化领域的发展，可谓是一举两得。 3 实践感悟 我们的实践队伍成员来自物理学院、外国语学院、匡亚明学院、大气学院、天文与空间科学学院等多个院系，可谓\"文理搭配，干活不累\"。在这次与家乡传统文化\"亲密接触\"的社会实践活动中，团队成员不仅收到了文化的熏陶，也对如何将理论与实践结合有了更加深刻的理解，同时也为进入社会做了初步的准备。 首先，我们得到了第一手的调查成果，并且根据调查结果给出了初步的建议。 当前，牡丹瓷等传统工艺品并不像很多人认为的那样不够精美或是守旧不前，相反，它们本身是非常东西好的，问题是出在\"走出去\"上面。 我们给出了\"故事展板\"建议，在门店外放置宣传展板，从而一方面吸引本地居民进店欣赏，一方面让外地有课产生一定的文化认同。 其次，几位理工科的同学发现在所学的课堂知识有了用武之地。 李先生提到了许多可能的创新点和当前应用的一些新技术。来自物理学院的李同学回忆起所学的物理学与纳米材料科学相关知识，和李先生提到的技术一模一样！而来自大气科学学院的王同学也惊喜地发现，大气污染物沉积的原理，居然可以应用到牡丹瓷的清洗上。 在与不同人的接触中，我们也加深了对基层产业与基层工作的理解，创新不只存在于研究所，也存在于任何一个岗位。 处在象牙塔中的我们，很多想法往往过于简单直接，比如认为宣传主要靠政府有关部门。实际上，传统文化的发扬，必然是文化界、商界、政府多方努力的结果。当前保护非物质文化遗 产仍是以\"有用论\"为价值取向，其共同点就是，非物质文化遗产都被有意识地视为\"公共领域\"，无论是被利用、还是被静态保存，谁愿意\"下手\"谁就\"下 手\"。借用经济学术语中的\"公地灾难\"来讲，如果人人都可以对某项财产收成享益，最终会出现这样一种局面: 人们因收成享益而耗费的社会总成本与该项财产带给人们的总收益相当。因此，这项财产没有 给社会增加任何净收益。那么，这些传统文化的瑰宝本质上应该是一个\"开放地\"吗？这值得我们所有人深入思考！ 最后，我们也展现了南大人的风采，发扬了\"嚼得菜根，做得大事\"的优良传统。 由于是在工作日进行的实践，我们特意避开了客流高峰及午休时间进行采访，尽量保证不影响其正常工作。此外，在参观库房时，我们自费购买了鞋套和防静电手套，体贴的考虑让李先生大为赞赏。 丝绸之路团队成员： this is encrpted 鸣谢 南京大学团委 ：活动指导、 资金支持 洛阳邮政主题邮局 ：他们根据文化领域的经验，给我们提出了很多针对性意见 Changelog 20160818 创建 20160820 完善","tags":"thoughts","title":"南京大学社会实践风采之：牡丹瓷的前世今生（来自丝绸之路团队）"},{"url":"https://brillliantz.github.io/MySite/quant/price_indicator.html","text":"/*! * * IPython notebook * */ /* CSS font colors for translated ANSI colors. */ .ansibold { font-weight: bold; } /* use dark versions for foreground, to improve visibility */ .ansiblack { color: black; } .ansired { color: darkred; } .ansigreen { color: darkgreen; } .ansiyellow { color: #c4a000; } .ansiblue { color: darkblue; } .ansipurple { color: darkviolet; } .ansicyan { color: steelblue; } .ansigray { color: gray; } /* and light for background, for the same reason */ .ansibgblack { background-color: black; } .ansibgred { background-color: red; } .ansibggreen { background-color: green; } .ansibgyellow { background-color: yellow; } .ansibgblue { background-color: blue; } .ansibgpurple { background-color: magenta; } .ansibgcyan { background-color: cyan; } .ansibggray { background-color: gray; } div.cell { /* Old browsers */ display: -webkit-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; display: -moz-box; -moz-box-orient: vertical; -moz-box-align: stretch; display: box; box-orient: vertical; box-align: stretch; /* Modern browsers */ display: flex; flex-direction: column; align-items: stretch; border-radius: 2px; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; border-width: 1px; border-style: solid; border-color: transparent; width: 100%; padding: 5px; /* This acts as a spacer between cells, that is outside the border */ margin: 0px; outline: none; border-left-width: 1px; padding-left: 5px; background: linear-gradient(to right, transparent -40px, transparent 1px, transparent 1px, transparent 100%); } div.cell.jupyter-soft-selected { border-left-color: #90CAF9; border-left-color: #E3F2FD; border-left-width: 1px; padding-left: 5px; border-right-color: #E3F2FD; border-right-width: 1px; background: #E3F2FD; } @media print { div.cell.jupyter-soft-selected { border-color: transparent; } } div.cell.selected { border-color: #ababab; border-left-width: 0px; padding-left: 6px; background: linear-gradient(to right, #42A5F5 -40px, #42A5F5 5px, transparent 5px, transparent 100%); } @media print { div.cell.selected { border-color: transparent; } } div.cell.selected.jupyter-soft-selected { border-left-width: 0; padding-left: 6px; background: linear-gradient(to right, #42A5F5 -40px, #42A5F5 7px, #E3F2FD 7px, #E3F2FD 100%); } .edit_mode div.cell.selected { border-color: #66BB6A; border-left-width: 0px; padding-left: 6px; background: linear-gradient(to right, #66BB6A -40px, #66BB6A 5px, transparent 5px, transparent 100%); } @media print { .edit_mode div.cell.selected { border-color: transparent; } } .prompt { /* This needs to be wide enough for 3 digit prompt numbers: In[100]: */ min-width: 14ex; /* This padding is tuned to match the padding on the CodeMirror editor. */ padding: 0.4em; margin: 0px; font-family: monospace; text-align: right; /* This has to match that of the the CodeMirror class line-height below */ line-height: 1.21429em; /* Don't highlight prompt number selection */ -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; /* Use default cursor */ cursor: default; } @media (max-width: 540px) { .prompt { text-align: left; } } div.inner_cell { /* Old browsers */ display: -webkit-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; display: -moz-box; -moz-box-orient: vertical; -moz-box-align: stretch; display: box; box-orient: vertical; box-align: stretch; /* Modern browsers */ display: flex; flex-direction: column; align-items: stretch; /* Old browsers */ -webkit-box-flex: 1; -moz-box-flex: 1; box-flex: 1; /* Modern browsers */ flex: 1; } @-moz-document url-prefix() { div.inner_cell { overflow-x: hidden; } } /* input_area and input_prompt must match in top border and margin for alignment */ div.input_area { border: 1px solid #cfcfcf; border-radius: 2px; background: #f7f7f7; line-height: 1.21429em; } /* This is needed so that empty prompt areas can collapse to zero height when there is no content in the output_subarea and the prompt. The main purpose of this is to make sure that empty JavaScript output_subareas have no height. */ div.prompt:empty { padding-top: 0; padding-bottom: 0; } div.unrecognized_cell { padding: 5px 5px 5px 0px; /* Old browsers */ display: -webkit-box; -webkit-box-orient: horizontal; -webkit-box-align: stretch; display: -moz-box; -moz-box-orient: horizontal; -moz-box-align: stretch; display: box; box-orient: horizontal; box-align: stretch; /* Modern browsers */ display: flex; flex-direction: row; align-items: stretch; } div.unrecognized_cell .inner_cell { border-radius: 2px; padding: 5px; font-weight: bold; color: red; border: 1px solid #cfcfcf; background: #eaeaea; } div.unrecognized_cell .inner_cell a { color: inherit; text-decoration: none; } div.unrecognized_cell .inner_cell a:hover { color: inherit; text-decoration: none; } @media (max-width: 540px) { div.unrecognized_cell > div.prompt { display: none; } } div.code_cell { /* avoid page breaking on code cells when printing */ } @media print { div.code_cell { page-break-inside: avoid; } } /* any special styling for code cells that are currently running goes here */ div.input { page-break-inside: avoid; /* Old browsers */ display: -webkit-box; -webkit-box-orient: horizontal; -webkit-box-align: stretch; display: -moz-box; -moz-box-orient: horizontal; -moz-box-align: stretch; display: box; box-orient: horizontal; box-align: stretch; /* Modern browsers */ display: flex; flex-direction: row; align-items: stretch; } @media (max-width: 540px) { div.input { /* Old browsers */ display: -webkit-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; display: -moz-box; -moz-box-orient: vertical; -moz-box-align: stretch; display: box; box-orient: vertical; box-align: stretch; /* Modern browsers */ display: flex; flex-direction: column; align-items: stretch; } } /* input_area and input_prompt must match in top border and margin for alignment */ div.input_prompt { color: #303F9F; border-top: 1px solid transparent; } div.input_area > div.highlight { margin: 0.4em; border: none; padding: 0px; background-color: transparent; } div.input_area > div.highlight > pre { margin: 0px; border: none; padding: 0px; background-color: transparent; } /* The following gets added to the <head> if it is detected that the user has a * monospace font with inconsistent normal/bold/italic height. See * notebookmain.js. Such fonts will have keywords vertically offset with * respect to the rest of the text. The user should select a better font. * See: https://github.com/ipython/ipython/issues/1503 * * .CodeMirror span { * vertical-align: bottom; * } */ .CodeMirror { line-height: 1.21429em; /* Changed from 1em to our global default */ font-size: 14px; height: auto; /* Changed to auto to autogrow */ background: none; /* Changed from white to allow our bg to show through */ } .CodeMirror-scroll { /* The CodeMirror docs are a bit fuzzy on if overflow-y should be hidden or visible.*/ /* We have found that if it is visible, vertical scrollbars appear with font size changes.*/ overflow-y: hidden; overflow-x: auto; } .CodeMirror-lines { /* In CM2, this used to be 0.4em, but in CM3 it went to 4px. We need the em value because */ /* we have set a different line-height and want this to scale with that. */ padding: 0.4em; } .CodeMirror-linenumber { padding: 0 8px 0 4px; } .CodeMirror-gutters { border-bottom-left-radius: 2px; border-top-left-radius: 2px; } .CodeMirror pre { /* In CM3 this went to 4px from 0 in CM2. We need the 0 value because of how we size */ /* .CodeMirror-lines */ padding: 0; border: 0; border-radius: 0; } /* Original style from softwaremaniacs.org (c) Ivan Sagalaev <Maniac@SoftwareManiacs.Org> Adapted from GitHub theme */ .highlight-base { color: #000; } .highlight-variable { color: #000; } .highlight-variable-2 { color: #1a1a1a; } .highlight-variable-3 { color: #333333; } .highlight-string { color: #BA2121; } .highlight-comment { color: #408080; font-style: italic; } .highlight-number { color: #080; } .highlight-atom { color: #88F; } .highlight-keyword { color: #008000; font-weight: bold; } .highlight-builtin { color: #008000; } .highlight-error { color: #f00; } .highlight-operator { color: #AA22FF; font-weight: bold; } .highlight-meta { color: #AA22FF; } /* previously not defined, copying from default codemirror */ .highlight-def { color: #00f; } .highlight-string-2 { color: #f50; } .highlight-qualifier { color: #555; } .highlight-bracket { color: #997; } .highlight-tag { color: #170; } .highlight-attribute { color: #00c; } .highlight-header { color: blue; } .highlight-quote { color: #090; } .highlight-link { color: #00c; } /* apply the same style to codemirror */ .cm-s-ipython span.cm-keyword { color: #008000; font-weight: bold; } .cm-s-ipython span.cm-atom { color: #88F; } .cm-s-ipython span.cm-number { color: #080; } .cm-s-ipython span.cm-def { color: #00f; } .cm-s-ipython span.cm-variable { color: #000; } .cm-s-ipython span.cm-operator { color: #AA22FF; font-weight: bold; } .cm-s-ipython span.cm-variable-2 { color: #1a1a1a; } .cm-s-ipython span.cm-variable-3 { color: #333333; } .cm-s-ipython span.cm-comment { color: #408080; font-style: italic; } .cm-s-ipython span.cm-string { color: #BA2121; } .cm-s-ipython span.cm-string-2 { color: #f50; } .cm-s-ipython span.cm-meta { color: #AA22FF; } .cm-s-ipython span.cm-qualifier { color: #555; } .cm-s-ipython span.cm-builtin { color: #008000; } .cm-s-ipython span.cm-bracket { color: #997; } .cm-s-ipython span.cm-tag { color: #170; } .cm-s-ipython span.cm-attribute { color: #00c; } .cm-s-ipython span.cm-header { color: blue; } .cm-s-ipython span.cm-quote { color: #090; } .cm-s-ipython span.cm-link { color: #00c; } .cm-s-ipython span.cm-error { color: #f00; } .cm-s-ipython span.cm-tab { background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAMCAYAAAAkuj5RAAAAAXNSR0IArs4c6QAAAGFJREFUSMft1LsRQFAQheHPowAKoACx3IgEKtaEHujDjORSgWTH/ZOdnZOcM/sgk/kFFWY0qV8foQwS4MKBCS3qR6ixBJvElOobYAtivseIE120FaowJPN75GMu8j/LfMwNjh4HUpwg4LUAAAAASUVORK5CYII=); background-position: right; background-repeat: no-repeat; } div.output_wrapper { /* this position must be relative to enable descendents to be absolute within it */ position: relative; /* Old browsers */ display: -webkit-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; display: -moz-box; -moz-box-orient: vertical; -moz-box-align: stretch; display: box; box-orient: vertical; box-align: stretch; /* Modern browsers */ display: flex; flex-direction: column; align-items: stretch; z-index: 1; } /* class for the output area when it should be height-limited */ div.output_scroll { /* ideally, this would be max-height, but FF barfs all over that */ height: 24em; /* FF needs this *and the wrapper* to specify full width, or it will shrinkwrap */ width: 100%; overflow: auto; border-radius: 2px; -webkit-box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.8); box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.8); display: block; } /* output div while it is collapsed */ div.output_collapsed { margin: 0px; padding: 0px; /* Old browsers */ display: -webkit-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; display: -moz-box; -moz-box-orient: vertical; -moz-box-align: stretch; display: box; box-orient: vertical; box-align: stretch; /* Modern browsers */ display: flex; flex-direction: column; align-items: stretch; } div.out_prompt_overlay { height: 100%; padding: 0px 0.4em; position: absolute; border-radius: 2px; } div.out_prompt_overlay:hover { /* use inner shadow to get border that is computed the same on WebKit/FF */ -webkit-box-shadow: inset 0 0 1px #000; box-shadow: inset 0 0 1px #000; background: rgba(240, 240, 240, 0.5); } div.output_prompt { color: #D84315; } /* This class is the outer container of all output sections. */ div.output_area { padding: 0px; page-break-inside: avoid; /* Old browsers */ display: -webkit-box; -webkit-box-orient: horizontal; -webkit-box-align: stretch; display: -moz-box; -moz-box-orient: horizontal; -moz-box-align: stretch; display: box; box-orient: horizontal; box-align: stretch; /* Modern browsers */ display: flex; flex-direction: row; align-items: stretch; } div.output_area .MathJax_Display { text-align: left !important; } div.output_area div.output_area div.output_area img, div.output_area svg { max-width: 100%; height: auto; } div.output_area img.unconfined, div.output_area svg.unconfined { max-width: none; } /* This is needed to protect the pre formating from global settings such as that of bootstrap */ .output { /* Old browsers */ display: -webkit-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; display: -moz-box; -moz-box-orient: vertical; -moz-box-align: stretch; display: box; box-orient: vertical; box-align: stretch; /* Modern browsers */ display: flex; flex-direction: column; align-items: stretch; } @media (max-width: 540px) { div.output_area { /* Old browsers */ display: -webkit-box; -webkit-box-orient: vertical; -webkit-box-align: stretch; display: -moz-box; -moz-box-orient: vertical; -moz-box-align: stretch; display: box; box-orient: vertical; box-align: stretch; /* Modern browsers */ display: flex; flex-direction: column; align-items: stretch; } } div.output_area pre { margin: 0; padding: 0; border: 0; vertical-align: baseline; color: black; background-color: transparent; border-radius: 0; } /* This class is for the output subarea inside the output_area and after the prompt div. */ div.output_subarea { overflow-x: auto; padding: 0.4em; /* Old browsers */ -webkit-box-flex: 1; -moz-box-flex: 1; box-flex: 1; /* Modern browsers */ flex: 1; max-width: calc(100% - 14ex); } div.output_scroll div.output_subarea { overflow-x: visible; } /* The rest of the output_* classes are for special styling of the different output types */ /* all text output has this class: */ div.output_text { text-align: left; color: #000; /* This has to match that of the the CodeMirror class line-height below */ line-height: 1.21429em; } /* stdout/stderr are 'text' as well as 'stream', but execute_result/error are *not* streams */ div.output_stderr { background: #fdd; /* very light red background for stderr */ } div.output_latex { text-align: left; } /* Empty output_javascript divs should have no height */ div.output_javascript:empty { padding: 0; } .js-error { color: darkred; } /* raw_input styles */ div.raw_input_container { line-height: 1.21429em; padding-top: 5px; } pre.raw_input_prompt { /* nothing needed here. */ } input.raw_input { font-family: monospace; font-size: inherit; color: inherit; width: auto; /* make sure input baseline aligns with prompt */ vertical-align: baseline; /* padding + margin = 0.5em between prompt and cursor */ padding: 0em 0.25em; margin: 0em 0.25em; } input.raw_input:focus { box-shadow: none; } p.p-space { margin-bottom: 10px; } div.output_unrecognized { padding: 5px; font-weight: bold; color: red; } div.output_unrecognized a { color: inherit; text-decoration: none; } div.output_unrecognized a:hover { color: inherit; text-decoration: none; } .rendered_html { color: #000; /* any extras will just be numbers: */ } .rendered_html :link { text-decoration: underline; } .rendered_html :visited { text-decoration: underline; } .rendered_html h1:first-child { margin-top: 0.538em; } .rendered_html h2:first-child { margin-top: 0.636em; } .rendered_html h3:first-child { margin-top: 0.777em; } .rendered_html h4:first-child { margin-top: 1em; } .rendered_html h5:first-child { margin-top: 1em; } .rendered_html h6:first-child { margin-top: 1em; } .rendered_html * + ul { margin-top: 1em; } .rendered_html * + ol { margin-top: 1em; } .rendered_html pre, .rendered_html tr, .rendered_html th, .rendered_html td, .rendered_html * + table { margin-top: 1em; } .rendered_html * + p { margin-top: 1em; } .rendered_html * + img { margin-top: 1em; } .rendered_html img, .rendered_html img.unconfined, div.text_cell { /* Old browsers */ display: -webkit-box; -webkit-box-orient: horizontal; -webkit-box-align: stretch; display: -moz-box; -moz-box-orient: horizontal; -moz-box-align: stretch; display: box; box-orient: horizontal; box-align: stretch; /* Modern browsers */ display: flex; flex-direction: row; align-items: stretch; } @media (max-width: 540px) { div.text_cell > div.prompt { display: none; } } div.text_cell_render { /*font-family: \"Helvetica Neue\", Arial, Helvetica, Geneva, sans-serif;*/ outline: none; resize: none; width: inherit; border-style: none; padding: 0.5em 0.5em 0.5em 0.4em; color: #000; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; } a.anchor-link:link { text-decoration: none; padding: 0px 20px; visibility: hidden; } h1:hover .anchor-link, h2:hover .anchor-link, h3:hover .anchor-link, h4:hover .anchor-link, h5:hover .anchor-link, h6:hover .anchor-link { visibility: visible; } .text_cell.rendered .input_area { display: none; } .text_cell.rendered .text_cell.unrendered .text_cell_render { display: none; } .cm-header-1, .cm-header-2, .cm-header-3, .cm-header-4, .cm-header-5, .cm-header-6 { font-weight: bold; font-family: \"Helvetica Neue\", Helvetica, Arial, sans-serif; } .cm-header-1 { font-size: 185.7%; } .cm-header-2 { font-size: 157.1%; } .cm-header-3 { font-size: 128.6%; } .cm-header-4 { font-size: 110%; } .cm-header-5 { font-size: 100%; font-style: italic; } .cm-header-6 { font-size: 100%; font-style: italic; } .highlight .hll { background-color: #ffffcc } .highlight { background: #f8f8f8; } .highlight .c { color: #408080; font-style: italic } /* Comment */ .highlight .err { border: 1px solid #FF0000 } /* Error */ .highlight .k { color: #008000; font-weight: bold } /* Keyword */ .highlight .o { color: #666666 } /* Operator */ .highlight .ch { color: #408080; font-style: italic } /* Comment.Hashbang */ .highlight .cm { color: #408080; font-style: italic } /* Comment.Multiline */ .highlight .cp { color: #BC7A00 } /* Comment.Preproc */ .highlight .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */ .highlight .c1 { color: #408080; font-style: italic } /* Comment.Single */ .highlight .cs { color: #408080; font-style: italic } /* Comment.Special */ .highlight .gd { color: #A00000 } /* Generic.Deleted */ .highlight .ge { font-style: italic } /* Generic.Emph */ .highlight .gr { color: #FF0000 } /* Generic.Error */ .highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */ .highlight .gi { color: #00A000 } /* Generic.Inserted */ .highlight .go { color: #888888 } /* Generic.Output */ .highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */ .highlight .gs { font-weight: bold } /* Generic.Strong */ .highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */ .highlight .gt { color: #0044DD } /* Generic.Traceback */ .highlight .kc { color: #008000; font-weight: bold } /* Keyword.Constant */ .highlight .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */ .highlight .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */ .highlight .kp { color: #008000 } /* Keyword.Pseudo */ .highlight .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */ .highlight .kt { color: #B00040 } /* Keyword.Type */ .highlight .m { color: #666666 } /* Literal.Number */ .highlight .s { color: #BA2121 } /* Literal.String */ .highlight .na { color: #7D9029 } /* Name.Attribute */ .highlight .nb { color: #008000 } /* Name.Builtin */ .highlight .nc { color: #0000FF; font-weight: bold } /* Name.Class */ .highlight .no { color: #880000 } /* Name.Constant */ .highlight .nd { color: #AA22FF } /* Name.Decorator */ .highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */ .highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */ .highlight .nf { color: #0000FF } /* Name.Function */ .highlight .nl { color: #A0A000 } /* Name.Label */ .highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */ .highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */ .highlight .nv { color: #19177C } /* Name.Variable */ .highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */ .highlight .w { color: #bbbbbb } /* Text.Whitespace */ .highlight .mb { color: #666666 } /* Literal.Number.Bin */ .highlight .mf { color: #666666 } /* Literal.Number.Float */ .highlight .mh { color: #666666 } /* Literal.Number.Hex */ .highlight .mi { color: #666666 } /* Literal.Number.Integer */ .highlight .mo { color: #666666 } /* Literal.Number.Oct */ .highlight .sb { color: #BA2121 } /* Literal.String.Backtick */ .highlight .sc { color: #BA2121 } /* Literal.String.Char */ .highlight .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */ .highlight .s2 { color: #BA2121 } /* Literal.String.Double */ .highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */ .highlight .sh { color: #BA2121 } /* Literal.String.Heredoc */ .highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */ .highlight .sx { color: #008000 } /* Literal.String.Other */ .highlight .sr { color: #BB6688 } /* Literal.String.Regex */ .highlight .s1 { color: #BA2121 } /* Literal.String.Single */ .highlight .ss { color: #19177C } /* Literal.String.Symbol */ .highlight .bp { color: #008000 } /* Name.Builtin.Pseudo */ .highlight .vc { color: #19177C } /* Name.Variable.Class */ .highlight .vg { color: #19177C } /* Name.Variable.Global */ .highlight .vi { color: #19177C } /* Name.Variable.Instance */ .highlight .il { color: #666666 } /* Literal.Number.Integer.Long */ /* Temporary definitions which will become obsolete with Notebook release 5.0 */ .ansi-black-fg { color: #3E424D; } .ansi-black-bg { background-color: #3E424D; } .ansi-black-intense-fg { color: #282C36; } .ansi-black-intense-bg { background-color: #282C36; } .ansi-red-fg { color: #E75C58; } .ansi-red-bg { background-color: #E75C58; } .ansi-red-intense-fg { color: #B22B31; } .ansi-red-intense-bg { background-color: #B22B31; } .ansi-green-fg { color: #00A250; } .ansi-green-bg { background-color: #00A250; } .ansi-green-intense-fg { color: #007427; } .ansi-green-intense-bg { background-color: #007427; } .ansi-yellow-fg { color: #DDB62B; } .ansi-yellow-bg { background-color: #DDB62B; } .ansi-yellow-intense-fg { color: #B27D12; } .ansi-yellow-intense-bg { background-color: #B27D12; } .ansi-blue-fg { color: #208FFB; } .ansi-blue-bg { background-color: #208FFB; } .ansi-blue-intense-fg { color: #0065CA; } .ansi-blue-intense-bg { background-color: #0065CA; } .ansi-magenta-fg { color: #D160C4; } .ansi-magenta-bg { background-color: #D160C4; } .ansi-magenta-intense-fg { color: #A03196; } .ansi-magenta-intense-bg { background-color: #A03196; } .ansi-cyan-fg { color: #60C6C8; } .ansi-cyan-bg { background-color: #60C6C8; } .ansi-cyan-intense-fg { color: #258F8F; } .ansi-cyan-intense-bg { background-color: #258F8F; } .ansi-white-fg { color: #C5C1B4; } .ansi-white-bg { background-color: #C5C1B4; } .ansi-white-intense-fg { color: #A1A6B2; } .ansi-white-intense-bg { background-color: #A1A6B2; } .ansi-bold { font-weight: bold; } In [1]: import numpy as np import pandas as pd import seaborn as sns import matplotlib.pyplot as plt # import matplotlib.finance as mf from matplotlib.widgets import MultiCursor import statsmodels.tsa.stattools as stt # import scipy.signal as sgn import statsmodels.api as sm # from statsmodels.sandbox.regression.predstd import wls_prediction_std # from matplotlib.mlab import PCA In [2]: % matplotlib inline In [3]: # Style. 1 sns . set_context ( 'paper' ) sns . set_style ( \"darkgrid\" ) In [4]: # Style. 2 sns . set_context ( 'paper' ) sns . set_style ( \"dark\" , rc = { 'axes.facecolor' : 'black' , 'grid.color' : 'red' , 'grid.linestyle' : '--' , 'figure.facecolor' : 'grey' }) In [5]: hft = pd . read_hdf ( '/home/bingnan/HFT_SR_RM_MA_TA.hdf' ) /usr/lib/python2.7/dist-packages/tables/leaf.py:392: PerformanceWarning: The Leaf ``/HFT/block0_values`` is exceeding the maximum recommended rowsize (104857600 bytes); be ready to see PyTables asking for *lots* of memory and possibly slow I/O. You may want to reduce the rowsize by trimming the value of dimensions that are orthogonal (and preferably close) to the *main* dimension of this leave. Alternatively, in case you have specified a very small/large chunksize, you may want to increase/decrease it. PerformanceWarning) In [6]: ta = hft . minor_xs ( 'TA0001' ) . copy () In [7]: #------------------------------------------------ '''Some time length''' night_len = int ( 4 * 3600 * 2.5 ) mor_len = int ( 4 * 3600 * 2.25 ) aftn_len = int ( 4 * 3600 * 1.5 ) day_len = night_len + mor_len + aftn_len + 4 In [26]: ta . ix [:, [ 'bidPrc_0' , 'bidPrc_1' , 'bidPrc_2' , 'askPrc_3' , 'bidPrc_4' , 'askPrc_1' , 'askPrc_2' , 'askPrc_3' , 'askPrc_4' ]] . any ( axis = 0 ) == 0 Out[26]: bidPrc_0 False bidPrc_1 False bidPrc_2 False askPrc_3 False bidPrc_4 False askPrc_1 False askPrc_2 False askPrc_3 False askPrc_4 False dtype: bool In [8]: #----------------------------------------------- '''add columns''' def AddCol ( df ): vol = df . ix [:, 'volume' ] . diff () # this addition is for the convenience of Log y scale plot # vol +=1 vol = vol . rename ( 'vol_diff' ) openint = df . ix [:, 'openInterest' ] . diff () # this addition is for the convenience of Log y scale plot # openint += 1 openint = openint . rename ( 'openInt_diff' ) mid = ( df . ix [:, 'askPrc_0' ] + df . ix [:, 'bidPrc_0' ]) / 2. mid = mid . rename ( 'midPrc' ) ret = df . join ([ vol , openint , mid ]) return ret # ------------------------------------------------- def ForwardDiff ( df , n = 1 ): ''' The reverse of pandas' function 'DataFrame.diff()' ''' ret = df . diff ( periods = n ) ret = ret . shift ( periods = - 1 * n ) ret = ret . dropna () return ret def CutHighVar ( df , length = 200 ): ''' Purpose: Cut a small period after opening in the morning and at night. Because this time range, the var of price is high, which harmd our model. df: pd.DataFrame or pd.Series. With datetime index length: int. the length you want to cut, counted in ticks. Cannot be larger than 240 ''' ret = df bool_arr1 = np . logical_or ( ret . index . hour == 21 , ret . index . hour == 9 ) bool_arr = np . logical_and . reduce ([ bool_arr1 , ret . index . minute == 0 , ret . index . second <= int ( length // 4 ) - 1 ]) ret = ret [ np . logical_not ( bool_arr )] return ret def CutTail ( df , length = 60 ): ''' Purpose: Cut a small period before market close. df: pd.DataFrame or pd.Series. With datetime index length: int. the length you want to cut, counted in ticks. Cannot be larger than 240 ''' ret = df last_boolean1 = np . logical_and . reduce ( [ ret . index . hour == 14 , ret . index . minute == 59 , ret . index . second >= 60 - int ( length // 4 )]) # this is the last tick last_boolean2 = ret . index . hour == 15 ret = ret [ np . logical_not ( np . logical_or ( last_boolean1 , last_boolean2 ))] return ret def DayChangeNum ( ser , distance = 7 ): ''' ser is price move series after process. distance counting in hours ''' h = ser . index . hour h_diff = np . diff ( h ) h_diff = np . insert ( h_diff , 1 , 0 ) ret = np . where ( np . abs ( h_diff ) > distance )[ 0 ] return ret def NormPriceMove ( ser , daychgnum ): ret = ser . copy () for i in range ( len ( daychgnum ) - 1 ): mysamp = ret . iloc [ daychgnum [ i ]: daychgnum [ i + 1 ]] #print mysamp mystd = mysamp . std () print mystd ret . iloc [ daychgnum [ i ]: daychgnum [ i + 1 ]] /= mystd return ret def CuthlLimit ( df , how = 'all' , depth = 0 ): s1 = 'bidQty_' + str ( depth ) s2 = 'askQty_' + str ( depth ) if how == 'all' : arr1 = df . ix [:, s1 ] == 0 arr2 = df [ s2 ] == 0 bool_arr = np . logical_or ( arr1 , arr2 ) #bool_arr = np.logical_or(df[s1] == 0, df[s2] == 0) elif how == 'bid' : bool_arr = ( df [ s1 ] == 0 ) elif how == 'ask' : bool_arr = ( df [ s2 ] == 0 ) else : print 'ERROR!' return df [ np . logical_not ( bool_arr )] def GiveMePM ( df , n = 44 , lim = [ 0 , 20 ], cutdepth = 0 , norm = False , high_var_length = 200 ): ''' Purpose: from original DataFrame calculate price move Series. Including CutTail and CutHighVar. df: the pinzhong DataFrame. n: forward_ticks lim: can be like (0, 20), counting in days, or an int array of index. norm: if True, normalize the price move using every day std. Return (last) price move series. ''' global day_len samp = CuthlLimit ( df , how = 'all' , depth = cutdepth ) if len ( lim ) == 2 : samp = samp . ix [ day_len * lim [ 0 ]: day_len * lim [ 1 ], 'midPrc' ] else : samp = samp . ix [ lim , 'midPrc' ] #print samp.index[0], samp.index[-1] ret = ForwardDiff ( samp , n ) ret = CutTail ( ret , n ) ret = CutHighVar ( ret , length = high_var_length ) if norm : ret_daychangenum = DayChangeNum ( ret ) ret = NormPriceMove ( ret , ret_daychangenum ) return ret In [9]: ta . columns Out[9]: Index([u'AveragePrice', u'LifeHigh', u'LifeLow', u'TotalAskLot', u'TotalBidLot', u'askPrc_0', u'askPrc_1', u'askPrc_2', u'askPrc_3', u'askPrc_4', u'askQty_0', u'askQty_1', u'askQty_2', u'askQty_3', u'askQty_4', u'bidPrc_0', u'bidPrc_1', u'bidPrc_2', u'bidPrc_3', u'bidPrc_4', u'bidQty_0', u'bidQty_1', u'bidQty_2', u'bidQty_3', u'bidQty_4', u'close', u'high', u'highLimit', u'last', u'low', u'lowLimit', u'open', u'openInterest', u'prevClose', u'prevOpenInterest', u'prevSettle', u'settle', u'volume'], dtype='object') In [10]: ta = AddCol ( ta ) #------------------------------------------------ '''training dataset and outsample dataset''' ta_in = ta.ix[: day_len*20, :] ta_out = ta.ix[day_len*20: day_len*25: , :] forward_ticks = 45 ta_in_pm = ForwardDiff(ta_in.ix[:, 'last'], forward_ticks) ta_out_pm = ForwardDiff(ta_out.ix[:, 'last'], forward_ticks) ta_in_pm = CutTail(ta_in_pm, forward_ticks) ta_out_pm = CutTail(ta_out_pm, forward_ticks) ta_in_pm = CutHighVar(ta_in_pm) ta_out_pm = CutHighVar(ta_out_pm) # ta_in_daychangenum = DayChangeNum(ta_in_pm) # ta_out_daychangenum = DayChangeNum(ta_out_pm) # ta_in_pm_norm = NormPriceMove(ta_in_pm, ta_in_daychangenum) # ta_out_pm_norm = NormPriceMove(ta_out_pm, ta_out_daychangenum) In [24]: def myols ( ser , pm , norm = False ): ''' ser is indicator Series pm is Price move Series sm is satatsmodel module this function also automatically align index of df and pm ''' global sm ser = ser [ pm . index ] ser = ser . dropna () if norm : ser = ( ser - ser . mean ()) / ser . std () X = sm . add_constant ( ser ) Y = pm [ X . index ] #print Y[211000:211070] #print X[211000:211070] model = sm . OLS ( Y , X ) ret = model . fit () return ret def Rsquare ( y , yhat ): ret = 1 - ( y - yhat ) . var () / y . var () return ret def Rsquare2 ( y , yhat ): ret = 1 - (( y - yhat ) ** 2 ) . mean () / y . var () return ret def PredictedRsquare ( res , xnew , pm ): ''' pm: outsample price move Series xnew: indicator Series (or DataFrame) res: insample regression results (comes from statsmodel's model.fit() ) ''' # first we need to align xnew with outsample xnew = xnew [ pm . index ] xnew = xnew . dropna () y = pm [ xnew . index ] xnew = sm . add_constant ( xnew ) ynew = res . predict ( xnew ) rsq = Rsquare ( y , ynew ) return rsq def PredictedRsquare2 ( res , xnew , pm ): ''' pm: outsample price move Series xnew: indicator Series (or DataFrame) res: insample regression results (comes from statsmodel's model.fit() ) ''' # first we need to align xnew with outsample xnew = xnew [ pm . index ] xnew = xnew . dropna () y = pm [ xnew . index ] xnew = sm . add_constant ( xnew ) ynew = res . predict ( xnew ) rsq = Rsquare2 ( y , ynew ) return rsq =========================================================================== Advanced Plot In [189]: % matplotlib auto Using matplotlib backend: TkAgg In [187]: def prc_total ( df , t1 , t2 , fs = ( 15 , 10 )): fig = plt . figure ( figsize = fs ) ax1 = fig . add_subplot ( 311 ) ax1 . plot ( df . ix [ t1 : t2 , 'last' ], color = '#f5f112' , marker = '*' ) ax1 . plot ( df . ix [ t1 : t2 , 'askPrc_0' ], color = 'lightgreen' ) ax1 . plot ( df . ix [ t1 : t2 , 'bidPrc_0' ], color = 'lightcoral' ) ax3 = fig . add_subplot ( 312 , sharex = ax1 ) ax3 . plot ( df . ix [ t1 : t2 , 'vol_diff' ], color = 'white' , lw = 0.4 , marker = '*' ) ax4 = fig . add_subplot ( 313 , sharex = ax1 ) ax4 . plot ( df . ix [ t1 : t2 , 'openInt_diff' ], color = 'red' , marker = '*' ) return fig In [191]: # -------------------------------------------- '''this is for macroly searching for patterns''' t11 , t22 = '2015-12-05 21:00:01' , '2015-12-08 15:00:00' # samp = ta_10day.ix[pm_index, :] thefig = prc_total ( ta , t11 , t22 , ( 15 , 10 )) multi = MultiCursor ( thefig . canvas , thefig . axes , color = 'c' , lw = 1 ) thefig . show () In [137]: vwap_indicator = VWAPIndicator ( ta , 50 ) In [147]: ta . ix [ 120 : 190 , 'last' ] Out[147]: 2015-11-19 21:00:30.000 1827.0 2015-11-19 21:00:30.250 1827.0 2015-11-19 21:00:30.500 1827.0 2015-11-19 21:00:30.750 1827.0 2015-11-19 21:00:31.000 1827.0 2015-11-19 21:00:31.250 1828.0 2015-11-19 21:00:31.500 1828.0 2015-11-19 21:00:31.750 1827.0 2015-11-19 21:00:32.000 1828.0 2015-11-19 21:00:32.250 1827.0 2015-11-19 21:00:32.500 1828.0 2015-11-19 21:00:32.750 1827.0 2015-11-19 21:00:33.000 1827.0 2015-11-19 21:00:33.250 1828.0 2015-11-19 21:00:33.500 1828.0 2015-11-19 21:00:33.750 1827.0 2015-11-19 21:00:34.000 1828.0 2015-11-19 21:00:34.250 1828.0 2015-11-19 21:00:34.500 1828.0 2015-11-19 21:00:34.750 1828.0 2015-11-19 21:00:35.000 1829.0 2015-11-19 21:00:35.250 1828.0 2015-11-19 21:00:35.500 1828.0 2015-11-19 21:00:35.750 1828.0 2015-11-19 21:00:36.000 1828.0 2015-11-19 21:00:36.250 1829.0 2015-11-19 21:00:36.500 1829.0 2015-11-19 21:00:36.750 1829.0 2015-11-19 21:00:37.000 1829.0 2015-11-19 21:00:37.250 1829.0 ... 2015-11-19 21:00:40.000 1829.0 2015-11-19 21:00:40.250 1830.0 2015-11-19 21:00:40.500 1830.0 2015-11-19 21:00:40.750 1829.0 2015-11-19 21:00:41.000 1829.0 2015-11-19 21:00:41.250 1830.0 2015-11-19 21:00:41.500 1829.0 2015-11-19 21:00:41.750 1830.0 2015-11-19 21:00:42.000 1830.0 2015-11-19 21:00:42.250 1830.0 2015-11-19 21:00:42.500 1830.0 2015-11-19 21:00:42.750 1829.0 2015-11-19 21:00:43.000 1830.0 2015-11-19 21:00:43.250 1830.0 2015-11-19 21:00:43.500 1829.0 2015-11-19 21:00:43.750 1830.0 2015-11-19 21:00:44.000 1830.0 2015-11-19 21:00:44.250 1829.0 2015-11-19 21:00:44.500 1829.0 2015-11-19 21:00:44.750 1829.0 2015-11-19 21:00:45.000 1829.0 2015-11-19 21:00:45.250 1829.0 2015-11-19 21:00:45.500 1829.0 2015-11-19 21:00:45.750 1829.0 2015-11-19 21:00:46.000 1829.0 2015-11-19 21:00:46.250 1830.0 2015-11-19 21:00:46.500 1829.0 2015-11-19 21:00:46.750 1829.0 2015-11-19 21:00:47.000 1829.0 2015-11-19 21:00:47.250 1829.0 Name: last, dtype: float64 In [142]: ta_in_pm Out[142]: 2015-11-19 21:00:32.000 1.0 2015-11-19 21:00:32.250 2.0 2015-11-19 21:00:32.500 1.0 2015-11-19 21:00:32.750 2.0 2015-11-19 21:00:33.000 2.0 2015-11-19 21:00:33.250 1.0 2015-11-19 21:00:33.500 1.0 2015-11-19 21:00:33.750 3.0 2015-11-19 21:00:34.000 1.0 2015-11-19 21:00:34.250 1.0 2015-11-19 21:00:34.500 1.0 2015-11-19 21:00:34.750 1.0 2015-11-19 21:00:35.000 0.0 2015-11-19 21:00:35.250 1.0 2015-11-19 21:00:35.500 0.0 2015-11-19 21:00:35.750 0.0 2015-11-19 21:00:36.000 1.0 2015-11-19 21:00:36.250 0.0 2015-11-19 21:00:36.500 0.0 2015-11-19 21:00:36.750 0.0 2015-11-19 21:00:37.000 0.0 2015-11-19 21:00:37.250 -1.0 2015-11-19 21:00:37.500 1.0 2015-11-19 21:00:37.750 1.0 2015-11-19 21:00:38.000 -1.0 2015-11-19 21:00:38.250 0.0 2015-11-19 21:00:38.500 0.0 2015-11-19 21:00:38.750 0.0 2015-11-19 21:00:39.000 -1.0 2015-11-19 21:00:39.250 0.0 ... 2015-12-17 14:59:39.500 -1.0 2015-12-17 14:59:39.750 0.0 2015-12-17 14:59:40.000 -1.0 2015-12-17 14:59:40.250 1.0 2015-12-17 14:59:40.500 0.0 2015-12-17 14:59:40.750 1.0 2015-12-17 14:59:41.000 0.0 2015-12-17 14:59:41.250 0.0 2015-12-17 14:59:41.500 0.0 2015-12-17 14:59:41.750 0.0 2015-12-17 14:59:42.000 0.0 2015-12-17 14:59:42.250 0.0 2015-12-17 14:59:42.500 -1.0 2015-12-17 14:59:42.750 -1.0 2015-12-17 14:59:43.000 0.0 2015-12-17 14:59:43.250 1.0 2015-12-17 14:59:43.500 -1.0 2015-12-17 14:59:43.750 0.0 2015-12-17 14:59:44.000 0.0 2015-12-17 14:59:44.250 1.0 2015-12-17 14:59:44.500 0.0 2015-12-17 14:59:44.750 -1.0 2015-12-17 14:59:45.000 0.0 2015-12-17 14:59:45.250 0.0 2015-12-17 14:59:45.500 0.0 2015-12-17 14:59:45.750 0.0 2015-12-17 14:59:46.000 1.0 2015-12-17 14:59:46.250 0.0 2015-12-17 14:59:46.500 0.0 2015-12-17 14:59:46.750 1.0 Name: last, dtype: float64 In [12]: def VWAPIndicator4 ( df , mywindow = 50 ): ''' use both openInt and volume to calculate 'real' new position. ''' #TODO: ewm last = df . ix [:, 'midPrc' ] new_position = df . ix [:, [ 'vol_diff' , 'openInt_diff' ]] . sum ( axis = 1 ) new_position += . 1 last_multiply_newpos = last * new_position multiply_roll = last_multiply_newpos . rolling ( window = mywindow ) newpos_roll = new_position . rolling ( window = mywindow ) vwap = multiply_roll . sum () * 1. / newpos_roll . sum () #print vwap[:15] #print last[:15] ret = vwap - last ret . name = 'vwap_indicator2' vwap . name = 'vwaPrc2' return vwap , ret In [13]: def VWAPIndicator3 ( df , mywindow = 50 ): #TODO: ewm last = df . ix [:, 'midPrc' ] #print (last.isnull()).sum() vol = df . ix [:, 'vol_diff' ] vol += 1. #print (vol.isnull()).sum() last_multiply_vol = last * vol #print (last_multiply_vol.isnull()).sum() multiply_roll = last_multiply_vol . rolling ( window = mywindow ) vol_roll = vol . rolling ( window = mywindow ) vwap = multiply_roll . sum () * 1. / vol_roll . sum () #print (vwap.isnull()).sum() #print vwap[:15] #print last[:15] ret = vwap - last ret . name = 'vwap_indicator' vwap . name = 'vwaPrc' return vwap , ret TEST!!! In [14]: def GiveMeIndex ( arri , arro ): ''' Generate integer index arr is a two dim ndarray, with each element being a time range(counting in days). ''' global day_len index_in = list () for k in arri : index_in = index_in + list ( range ( day_len * k [ 0 ], day_len * k [ 1 ])) index_out = list () for k in arro : index_out = index_out + list ( range ( day_len * k [ 0 ], day_len * k [ 1 ])) return index_in , index_out In [15]: insample_index0 , outsample_index0 = GiveMeIndex ([[ 0 , 2 ], [ 4 , 6 ], [ 8 , 10 ], [ 14 , 16 ], [ 18 , 20 ], [ 22 , 24 ], [ 26 , 28 ]], [[ 2 , 4 ], [ 6 , 8 ], [ 12 , 14 ], [ 16 , 18 ], [ 20 , 22 ], [ 24 , 26 ], [ 28 , 30 ]]) insample_index1 , outsample_index1 = GiveMeIndex ([[ 0 , 20 ]], [[ 20 , 25 ]]) insample_index2 , outsample_index2 = GiveMeIndex ([[ 5 , 25 ]], [[ 0 , 5 ]]) insample_index3 , outsample_index3 = GiveMeIndex ([[ 0 , 5 ], [ 10 , 25 ]], [[ 5 , 10 ]]) insample_index4 , outsample_index4 = GiveMeIndex ([[ 0 , 10 ], [ 15 , 25 ]], [[ 10 , 15 ]]) insample_index5 , outsample_index5 = GiveMeIndex ([[ 0 , 13 ]], [[ 13 , 25 ]]) insample_index6 , outsample_index6 = GiveMeIndex ([[ 0 , 18 ]], [[ 18 , 25 ]]) # different_io_index = ((insample_index0, outsample_index0), (insample_index1, outsample_index1), # (insample_index2, outsample_index2), (insample_index3, outsample_index3), # (insample_index4, outsample_index4), (insample_index5, outsample_index5)) insample_index00 , outsample_index00 = GiveMeIndex ([[ 0 , 20 ]], [[ 25 , 30 ]]) In [26]: #------------------------------------------------------------------------------- ''' Automatically generate in and out sample data, then calculate Qty_indicator, then regression under different parameters ''' for mywind in [ 10 , 30 , 100 , 240 , 1000 , 2400 ]: vwap , vwap_indicator = VWAPIndicator4 ( ta , mywind ) #print pd.concat([ta[['last','vol_diff']],vwap,vwap_indicator],axis=1) for forward_ticks in range ( 44 , 45 , 1 ): ta_in_pm = GiveMePM ( ta , n = forward_ticks , lim = insample_index1 ) #print pd.concat([ta_in_pm,ta['last']],axis=1).dropna() ta_out_pm = GiveMePM ( ta , n = forward_ticks , lim = outsample_index1 ) #df = pd.concat([vwap_indicator, ta_in_pm],axis=1) #df.dropna(inplace=True) res = myols ( vwap_indicator , ta_in_pm ) print ( ' \\n\\n\\n ------------------------------X length: %d , Y length: %d ------------------------------' % ( mywind , forward_ticks )) print ( 'In sample time range: %s to %s \\n Out sample time range: %s to %s . \\n ' % ( ta_in_pm . index [ 0 ], ta_in_pm . index [ - 1 ], ta_out_pm . index [ 0 ], ta_out_pm . index [ - 1 ])) print res . summary () #print ta_in_pm.describe() #print ta_out_pm.describe() print ' \\n [OutSample R_SQUARE: %f ]' % PredictedRsquare ( res , vwap_indicator , ta_out_pm ) print ' \\n [OutSample R_SQUARE: %f ]' % PredictedRsquare2 ( res , vwap_indicator , ta_out_pm ) ------------------------------X length: 10, Y length: 44 ------------------------------ In sample time range: 2015-11-19 21:00:50 to 2015-12-17 21:15:53.250000 Out sample time range: 2015-12-17 21:16:04.500000 to 2015-12-24 21:15:53.250000. OLS Regression Results ============================================================================== Dep. Variable: midPrc R-squared: 0.000 Model: OLS Adj. R-squared: 0.000 Method: Least Squares F-statistic: 3.764 Date: Sun, 17 Jul 2016 Prob (F-statistic): 0.0524 Time: 04:26:26 Log-Likelihood: -3.1137e+06 No. Observations: 1790936 AIC: 6.227e+06 Df Residuals: 1790934 BIC: 6.227e+06 Df Model: 1 =================================================================================== coef std err t P>|t| [95.0% Conf. Int.] ----------------------------------------------------------------------------------- const 0.0037 0.001 3.634 0.000 0.002 0.006 vwap_indicator2 0.0002 0.000 1.940 0.052 -2.04e-06 0.000 ============================================================================== Omnibus: 644865.163 Durbin-Watson: 0.083 Prob(Omnibus): 0.000 Jarque-Bera (JB): 134740837.563 Skew: 0.553 Prob(JB): 0.00 Kurtosis: 45.478 Cond. No. 10.0 ============================================================================== [OutSample R_SQUARE: 0.000012] [OutSample R_SQUARE: -0.000010] ------------------------------X length: 30, Y length: 44 ------------------------------ In sample time range: 2015-11-19 21:00:50 to 2015-12-17 21:15:53.250000 Out sample time range: 2015-12-17 21:16:04.500000 to 2015-12-24 21:15:53.250000. OLS Regression Results ============================================================================== Dep. Variable: midPrc R-squared: 0.000 Model: OLS Adj. R-squared: -0.000 Method: Least Squares F-statistic: 0.08203 Date: Sun, 17 Jul 2016 Prob (F-statistic): 0.775 Time: 04:26:31 Log-Likelihood: -3.1137e+06 No. Observations: 1790936 AIC: 6.227e+06 Df Residuals: 1790934 BIC: 6.227e+06 Df Model: 1 =================================================================================== coef std err t P>|t| [95.0% Conf. Int.] ----------------------------------------------------------------------------------- const 0.0037 0.001 3.624 0.000 0.002 0.006 vwap_indicator2 1.726e-05 6.03e-05 0.286 0.775 -0.000 0.000 ============================================================================== Omnibus: 644857.802 Durbin-Watson: 0.084 Prob(Omnibus): 0.000 Jarque-Bera (JB): 134737775.005 Skew: 0.553 Prob(JB): 0.00 Kurtosis: 45.478 Cond. No. 17.1 ============================================================================== [OutSample R_SQUARE: 0.000002] [OutSample R_SQUARE: -0.000020] ------------------------------X length: 100, Y length: 44 ------------------------------ In sample time range: 2015-11-19 21:00:50 to 2015-12-17 21:15:53.250000 Out sample time range: 2015-12-17 21:16:04.500000 to 2015-12-24 21:15:53.250000. OLS Regression Results ============================================================================== Dep. Variable: midPrc R-squared: 0.000 Model: OLS Adj. R-squared: 0.000 Method: Least Squares F-statistic: 32.92 Date: Sun, 17 Jul 2016 Prob (F-statistic): 9.62e-09 Time: 04:26:36 Log-Likelihood: -3.1137e+06 No. Observations: 1790936 AIC: 6.227e+06 Df Residuals: 1790934 BIC: 6.227e+06 Df Model: 1 =================================================================================== coef std err t P>|t| [95.0% Conf. Int.] ----------------------------------------------------------------------------------- const 0.0036 0.001 3.510 0.000 0.002 0.006 vwap_indicator2 -0.0002 4.17e-05 -5.737 0.000 -0.000 -0.000 ============================================================================== Omnibus: 644789.252 Durbin-Watson: 0.084 Prob(Omnibus): 0.000 Jarque-Bera (JB): 134724711.407 Skew: 0.553 Prob(JB): 0.00 Kurtosis: 45.476 Cond. No. 24.7 ============================================================================== [OutSample R_SQUARE: -0.000047] [OutSample R_SQUARE: -0.000070] ------------------------------X length: 240, Y length: 44 ------------------------------ In sample time range: 2015-11-19 21:00:50 to 2015-12-17 21:15:53.250000 Out sample time range: 2015-12-17 21:16:04.500000 to 2015-12-24 21:15:53.250000. OLS Regression Results ============================================================================== Dep. Variable: midPrc R-squared: 0.000 Model: OLS Adj. R-squared: 0.000 Method: Least Squares F-statistic: 36.77 Date: Sun, 17 Jul 2016 Prob (F-statistic): 1.33e-09 Time: 04:26:41 Log-Likelihood: -3.1133e+06 No. Observations: 1790896 AIC: 6.227e+06 Df Residuals: 1790894 BIC: 6.227e+06 Df Model: 1 =================================================================================== coef std err t P>|t| [95.0% Conf. Int.] ----------------------------------------------------------------------------------- const 0.0037 0.001 3.595 0.000 0.002 0.006 vwap_indicator2 -0.0002 3.44e-05 -6.064 0.000 -0.000 -0.000 ============================================================================== Omnibus: 645479.661 Durbin-Watson: 0.084 Prob(Omnibus): 0.000 Jarque-Bera (JB): 134872204.819 Skew: 0.555 Prob(JB): 0.00 Kurtosis: 45.499 Cond. No. 29.9 ============================================================================== [OutSample R_SQUARE: -0.000047] [OutSample R_SQUARE: -0.000069] ------------------------------X length: 1000, Y length: 44 ------------------------------ In sample time range: 2015-11-19 21:00:50 to 2015-12-17 21:15:53.250000 Out sample time range: 2015-12-17 21:16:04.500000 to 2015-12-24 21:15:53.250000. OLS Regression Results ============================================================================== Dep. Variable: midPrc R-squared: 0.000 Model: OLS Adj. R-squared: 0.000 Method: Least Squares F-statistic: 68.01 Date: Sun, 17 Jul 2016 Prob (F-statistic): 1.63e-16 Time: 04:26:47 Log-Likelihood: -3.1109e+06 No. Observations: 1790136 AIC: 6.222e+06 Df Residuals: 1790134 BIC: 6.222e+06 Df Model: 1 =================================================================================== coef std err t P>|t| [95.0% Conf. Int.] ----------------------------------------------------------------------------------- const 0.0037 0.001 3.597 0.000 0.002 0.006 vwap_indicator2 -0.0003 3.32e-05 -8.247 0.000 -0.000 -0.000 ============================================================================== Omnibus: 646241.117 Durbin-Watson: 0.084 Prob(Omnibus): 0.000 Jarque-Bera (JB): 135452805.439 Skew: 0.558 Prob(JB): 0.00 Kurtosis: 45.600 Cond. No. 31.0 ============================================================================== [OutSample R_SQUARE: -0.000080] [OutSample R_SQUARE: -0.000101] ------------------------------X length: 2400, Y length: 44 ------------------------------ In sample time range: 2015-11-19 21:00:50 to 2015-12-17 21:15:53.250000 Out sample time range: 2015-12-17 21:16:04.500000 to 2015-12-24 21:15:53.250000. OLS Regression Results ============================================================================== Dep. Variable: midPrc R-squared: 0.000 Model: OLS Adj. R-squared: 0.000 Method: Least Squares F-statistic: 21.98 Date: Sun, 17 Jul 2016 Prob (F-statistic): 2.76e-06 Time: 04:26:52 Log-Likelihood: -3.1083e+06 No. Observations: 1788736 AIC: 6.217e+06 Df Residuals: 1788734 BIC: 6.217e+06 Df Model: 1 =================================================================================== coef std err t P>|t| [95.0% Conf. Int.] ----------------------------------------------------------------------------------- const 0.0038 0.001 3.668 0.000 0.002 0.006 vwap_indicator2 -0.0002 3.52e-05 -4.688 0.000 -0.000 -9.61e-05 ============================================================================== Omnibus: 646138.873 Durbin-Watson: 0.084 Prob(Omnibus): 0.000 Jarque-Bera (JB): 135685503.581 Skew: 0.559 Prob(JB): 0.00 Kurtosis: 45.653 Cond. No. 29.2 ============================================================================== [OutSample R_SQUARE: -0.000052] [OutSample R_SQUARE: -0.000073] In [66]: TEMP1 = pd . concat ([ ta1 , vwap_indicator , vwap ], axis = 1 ) In [69]: vwap . ix [ '2015-11-23 23:13:40' : '2015-11-23 23:13:50' ] Out[69]: 2015-11-23 23:13:40.000 4416.0 2015-11-23 23:13:40.250 4416.0 2015-11-23 23:13:40.500 4416.0 2015-11-23 23:13:40.750 4416.0 2015-11-23 23:13:41.000 4416.0 2015-11-23 23:13:41.250 4416.0 2015-11-23 23:13:41.500 4416.0 2015-11-23 23:13:41.750 4416.0 2015-11-23 23:13:42.000 4416.0 2015-11-23 23:13:42.250 4416.0 2015-11-23 23:13:42.500 4416.0 2015-11-23 23:13:42.750 4416.0 2015-11-23 23:13:43.000 4416.0 2015-11-23 23:13:43.250 4416.0 2015-11-23 23:13:43.500 4418.0 2015-11-23 23:13:43.750 4418.0 2015-11-23 23:13:44.000 4418.0 2015-11-23 23:13:44.250 4418.0 2015-11-23 23:13:44.500 4418.0 2015-11-23 23:13:44.750 4418.0 2015-11-23 23:13:45.000 4418.0 2015-11-23 23:13:45.250 4418.0 2015-11-23 23:13:45.500 4416.0 2015-11-23 23:13:45.750 4416.0 2015-11-23 23:13:46.000 4418.0 2015-11-23 23:13:46.250 4416.0 2015-11-23 23:13:46.500 4418.0 2015-11-23 23:13:46.750 4418.0 2015-11-23 23:13:47.000 4418.0 2015-11-23 23:13:47.250 4418.0 2015-11-23 23:13:47.500 4418.0 2015-11-23 23:13:47.750 4418.0 2015-11-23 23:13:48.000 4418.0 2015-11-23 23:13:48.250 4418.0 2015-11-23 23:13:48.500 4418.0 2015-11-23 23:13:48.750 4418.0 2015-11-23 23:13:49.000 4418.0 2015-11-23 23:13:49.250 4418.0 2015-11-23 23:13:49.500 4418.0 2015-11-23 23:13:49.750 4420.0 2015-11-23 23:13:50.000 4420.0 2015-11-23 23:13:50.250 4418.0 2015-11-23 23:13:50.500 4418.0 2015-11-23 23:13:50.750 4418.0 Name: vwaPrc, dtype: float64 Out[69]: 2015-11-23 23:13:40.000 4416.0 2015-11-23 23:13:40.250 4416.0 2015-11-23 23:13:40.500 4416.0 2015-11-23 23:13:40.750 4416.0 2015-11-23 23:13:41.000 4416.0 2015-11-23 23:13:41.250 4416.0 2015-11-23 23:13:41.500 4416.0 2015-11-23 23:13:41.750 4416.0 2015-11-23 23:13:42.000 4416.0 2015-11-23 23:13:42.250 4416.0 2015-11-23 23:13:42.500 4416.0 2015-11-23 23:13:42.750 4416.0 2015-11-23 23:13:43.000 4416.0 2015-11-23 23:13:43.250 4416.0 2015-11-23 23:13:43.500 4418.0 2015-11-23 23:13:43.750 4418.0 2015-11-23 23:13:44.000 4418.0 2015-11-23 23:13:44.250 4418.0 2015-11-23 23:13:44.500 4418.0 2015-11-23 23:13:44.750 4418.0 2015-11-23 23:13:45.000 4418.0 2015-11-23 23:13:45.250 4418.0 2015-11-23 23:13:45.500 4416.0 2015-11-23 23:13:45.750 4416.0 2015-11-23 23:13:46.000 4418.0 2015-11-23 23:13:46.250 4416.0 2015-11-23 23:13:46.500 4418.0 2015-11-23 23:13:46.750 4418.0 2015-11-23 23:13:47.000 4418.0 2015-11-23 23:13:47.250 4418.0 2015-11-23 23:13:47.500 4418.0 2015-11-23 23:13:47.750 4418.0 2015-11-23 23:13:48.000 4418.0 2015-11-23 23:13:48.250 4418.0 2015-11-23 23:13:48.500 4418.0 2015-11-23 23:13:48.750 4418.0 2015-11-23 23:13:49.000 4418.0 2015-11-23 23:13:49.250 4418.0 2015-11-23 23:13:49.500 4418.0 2015-11-23 23:13:49.750 4420.0 2015-11-23 23:13:50.000 4420.0 2015-11-23 23:13:50.250 4418.0 2015-11-23 23:13:50.500 4418.0 2015-11-23 23:13:50.750 4418.0 Name: vwaPrc, dtype: float64 Out[69]: 2015-11-23 23:13:40.000 4416.0 2015-11-23 23:13:40.250 4416.0 2015-11-23 23:13:40.500 4416.0 2015-11-23 23:13:40.750 4416.0 2015-11-23 23:13:41.000 4416.0 2015-11-23 23:13:41.250 4416.0 2015-11-23 23:13:41.500 4416.0 2015-11-23 23:13:41.750 4416.0 2015-11-23 23:13:42.000 4416.0 2015-11-23 23:13:42.250 4416.0 2015-11-23 23:13:42.500 4416.0 2015-11-23 23:13:42.750 4416.0 2015-11-23 23:13:43.000 4416.0 2015-11-23 23:13:43.250 4416.0 2015-11-23 23:13:43.500 4418.0 2015-11-23 23:13:43.750 4418.0 2015-11-23 23:13:44.000 4418.0 2015-11-23 23:13:44.250 4418.0 2015-11-23 23:13:44.500 4418.0 2015-11-23 23:13:44.750 4418.0 2015-11-23 23:13:45.000 4418.0 2015-11-23 23:13:45.250 4418.0 2015-11-23 23:13:45.500 4416.0 2015-11-23 23:13:45.750 4416.0 2015-11-23 23:13:46.000 4418.0 2015-11-23 23:13:46.250 4416.0 2015-11-23 23:13:46.500 4418.0 2015-11-23 23:13:46.750 4418.0 2015-11-23 23:13:47.000 4418.0 2015-11-23 23:13:47.250 4418.0 2015-11-23 23:13:47.500 4418.0 2015-11-23 23:13:47.750 4418.0 2015-11-23 23:13:48.000 4418.0 2015-11-23 23:13:48.250 4418.0 2015-11-23 23:13:48.500 4418.0 2015-11-23 23:13:48.750 4418.0 2015-11-23 23:13:49.000 4418.0 2015-11-23 23:13:49.250 4418.0 2015-11-23 23:13:49.500 4418.0 2015-11-23 23:13:49.750 4420.0 2015-11-23 23:13:50.000 4420.0 2015-11-23 23:13:50.250 4418.0 2015-11-23 23:13:50.500 4418.0 2015-11-23 23:13:50.750 4418.0 Name: vwaPrc, dtype: float64 In [71]: TEMP1 . ix [ '2015-11-23 23:13:40' : '2015-11-23 23:13:50' , [ 'last' , 'volume' , 'vol_diff' , 'vwap' , 'vwap_indicator' ]] Out[71]: last volume vol_diff vwap vwap_indicator 2015-11-23 23:13:40.000 4416.0 559906.0 4.0 NaN 0.0 2015-11-23 23:13:40.250 4416.0 559914.0 8.0 NaN 0.0 2015-11-23 23:13:40.500 4416.0 559914.0 0.0 NaN 0.0 2015-11-23 23:13:40.750 4416.0 559914.0 0.0 NaN 0.0 2015-11-23 23:13:41.000 4416.0 559914.0 0.0 NaN 0.0 2015-11-23 23:13:41.250 4416.0 559914.0 0.0 NaN 0.0 2015-11-23 23:13:41.500 4416.0 559914.0 0.0 NaN 0.0 2015-11-23 23:13:41.750 4416.0 559914.0 0.0 NaN 0.0 2015-11-23 23:13:42.000 4416.0 559914.0 0.0 NaN 0.0 2015-11-23 23:13:42.250 4416.0 559914.0 0.0 NaN 0.0 2015-11-23 23:13:42.500 4416.0 559916.0 2.0 NaN 0.0 2015-11-23 23:13:42.750 4416.0 559916.0 0.0 NaN 0.0 2015-11-23 23:13:43.000 4416.0 559916.0 0.0 NaN 0.0 2015-11-23 23:13:43.250 4416.0 559916.0 0.0 NaN 0.0 2015-11-23 23:13:43.500 4418.0 559918.0 2.0 NaN 0.0 2015-11-23 23:13:43.750 4418.0 559918.0 0.0 NaN 0.0 2015-11-23 23:13:44.000 4418.0 559924.0 6.0 NaN 0.0 2015-11-23 23:13:44.250 4418.0 559924.0 0.0 NaN 0.0 2015-11-23 23:13:44.500 4418.0 559924.0 0.0 NaN 0.0 2015-11-23 23:13:44.750 4418.0 559924.0 0.0 NaN 0.0 2015-11-23 23:13:45.000 4418.0 559924.0 0.0 NaN 0.0 2015-11-23 23:13:45.250 4418.0 559924.0 0.0 NaN 0.0 2015-11-23 23:13:45.500 4416.0 559934.0 10.0 NaN 0.0 2015-11-23 23:13:45.750 4416.0 559934.0 0.0 NaN 0.0 2015-11-23 23:13:46.000 4418.0 559940.0 6.0 NaN 0.0 2015-11-23 23:13:46.250 4416.0 559942.0 2.0 NaN 0.0 2015-11-23 23:13:46.500 4418.0 560542.0 600.0 NaN 0.0 2015-11-23 23:13:46.750 4418.0 560542.0 0.0 NaN 0.0 2015-11-23 23:13:47.000 4418.0 560542.0 0.0 NaN 0.0 2015-11-23 23:13:47.250 4418.0 560576.0 34.0 NaN 0.0 2015-11-23 23:13:47.500 4418.0 560594.0 18.0 NaN 0.0 2015-11-23 23:13:47.750 4418.0 560610.0 16.0 NaN 0.0 2015-11-23 23:13:48.000 4418.0 560610.0 0.0 NaN 0.0 2015-11-23 23:13:48.250 4418.0 560610.0 0.0 NaN 0.0 2015-11-23 23:13:48.500 4418.0 560610.0 0.0 NaN 0.0 2015-11-23 23:13:48.750 4418.0 560612.0 2.0 NaN 0.0 2015-11-23 23:13:49.000 4418.0 560612.0 0.0 NaN 0.0 2015-11-23 23:13:49.250 4418.0 560612.0 0.0 NaN 0.0 2015-11-23 23:13:49.500 4418.0 560612.0 0.0 NaN 0.0 2015-11-23 23:13:49.750 4420.0 560692.0 80.0 NaN 0.0 2015-11-23 23:13:50.000 4420.0 560736.0 44.0 NaN 0.0 2015-11-23 23:13:50.250 4418.0 560738.0 2.0 NaN 0.0 2015-11-23 23:13:50.500 4418.0 560738.0 0.0 NaN 0.0 2015-11-23 23:13:50.750 4418.0 560738.0 0.0 NaN 0.0 In [50]: ta1 . ix [ '2015-11-23 23:13:40' : '2015-11-23 23:13:50' , [ 'last' , 'volume' , 'vol_diff' ]] Out[50]: last volume vol_diff 2015-11-23 23:13:40.000 4416.0 559906.0 4.0 2015-11-23 23:13:40.250 4416.0 559914.0 8.0 2015-11-23 23:13:40.500 4416.0 559914.0 0.0 2015-11-23 23:13:40.750 4416.0 559914.0 0.0 2015-11-23 23:13:41.000 4416.0 559914.0 0.0 2015-11-23 23:13:41.250 4416.0 559914.0 0.0 2015-11-23 23:13:41.500 4416.0 559914.0 0.0 2015-11-23 23:13:41.750 4416.0 559914.0 0.0 2015-11-23 23:13:42.000 4416.0 559914.0 0.0 2015-11-23 23:13:42.250 4416.0 559914.0 0.0 2015-11-23 23:13:42.500 4416.0 559916.0 2.0 2015-11-23 23:13:42.750 4416.0 559916.0 0.0 2015-11-23 23:13:43.000 4416.0 559916.0 0.0 2015-11-23 23:13:43.250 4416.0 559916.0 0.0 2015-11-23 23:13:43.500 4418.0 559918.0 2.0 2015-11-23 23:13:43.750 4418.0 559918.0 0.0 2015-11-23 23:13:44.000 4418.0 559924.0 6.0 2015-11-23 23:13:44.250 4418.0 559924.0 0.0 2015-11-23 23:13:44.500 4418.0 559924.0 0.0 2015-11-23 23:13:44.750 4418.0 559924.0 0.0 2015-11-23 23:13:45.000 4418.0 559924.0 0.0 2015-11-23 23:13:45.250 4418.0 559924.0 0.0 2015-11-23 23:13:45.500 4416.0 559934.0 10.0 2015-11-23 23:13:45.750 4416.0 559934.0 0.0 2015-11-23 23:13:46.000 4418.0 559940.0 6.0 2015-11-23 23:13:46.250 4416.0 559942.0 2.0 2015-11-23 23:13:46.500 4418.0 560542.0 600.0 2015-11-23 23:13:46.750 4418.0 560542.0 0.0 2015-11-23 23:13:47.000 4418.0 560542.0 0.0 2015-11-23 23:13:47.250 4418.0 560576.0 34.0 2015-11-23 23:13:47.500 4418.0 560594.0 18.0 2015-11-23 23:13:47.750 4418.0 560610.0 16.0 2015-11-23 23:13:48.000 4418.0 560610.0 0.0 2015-11-23 23:13:48.250 4418.0 560610.0 0.0 2015-11-23 23:13:48.500 4418.0 560610.0 0.0 2015-11-23 23:13:48.750 4418.0 560612.0 2.0 2015-11-23 23:13:49.000 4418.0 560612.0 0.0 2015-11-23 23:13:49.250 4418.0 560612.0 0.0 2015-11-23 23:13:49.500 4418.0 560612.0 0.0 2015-11-23 23:13:49.750 4420.0 560692.0 80.0 2015-11-23 23:13:50.000 4420.0 560736.0 44.0 2015-11-23 23:13:50.250 4418.0 560738.0 2.0 2015-11-23 23:13:50.500 4418.0 560738.0 0.0 2015-11-23 23:13:50.750 4418.0 560738.0 0.0 In [27]: ta1 . ix [ '2015-11-23 23:13:50' : '2015-11-23 23:14:04' , [ 'last' , 'volume' , 'vol_diff' ]] Out[27]: last volume vol_diff 2015-11-23 23:13:50.000 4420.0 560736.0 44.0 2015-11-23 23:13:50.250 4418.0 560738.0 2.0 2015-11-23 23:13:50.500 4418.0 560738.0 0.0 2015-11-23 23:13:50.750 4418.0 560738.0 0.0 2015-11-23 23:13:51.000 4418.0 560740.0 2.0 2015-11-23 23:13:51.250 4418.0 560740.0 0.0 2015-11-23 23:13:51.500 4420.0 560840.0 100.0 2015-11-23 23:13:51.750 4420.0 560840.0 0.0 2015-11-23 23:13:52.000 4420.0 560850.0 10.0 2015-11-23 23:13:52.250 4420.0 560850.0 0.0 2015-11-23 23:13:52.500 4418.0 560860.0 10.0 2015-11-23 23:13:52.750 4418.0 560860.0 0.0 2015-11-23 23:13:53.000 4418.0 560860.0 0.0 2015-11-23 23:13:53.250 4418.0 560860.0 0.0 2015-11-23 23:13:53.500 4418.0 560860.0 0.0 2015-11-23 23:13:53.750 4418.0 560860.0 0.0 2015-11-23 23:13:54.000 4420.0 560880.0 20.0 2015-11-23 23:13:54.250 4420.0 560880.0 0.0 2015-11-23 23:13:54.500 4418.0 560890.0 10.0 2015-11-23 23:13:54.750 4418.0 560890.0 0.0 2015-11-23 23:13:55.000 4420.0 560994.0 104.0 2015-11-23 23:13:55.250 4420.0 560994.0 0.0 2015-11-23 23:13:55.500 4420.0 560994.0 0.0 2015-11-23 23:13:55.750 4420.0 560994.0 0.0 2015-11-23 23:13:56.000 4420.0 561196.0 202.0 2015-11-23 23:13:56.250 4420.0 561196.0 0.0 2015-11-23 23:13:56.500 4420.0 561278.0 82.0 2015-11-23 23:13:56.750 4420.0 561284.0 6.0 2015-11-23 23:13:57.000 4420.0 561288.0 4.0 2015-11-23 23:13:57.250 4420.0 561288.0 0.0 2015-11-23 23:13:57.500 4420.0 561288.0 0.0 2015-11-23 23:13:57.750 4420.0 561288.0 0.0 2015-11-23 23:13:58.000 4420.0 561296.0 8.0 2015-11-23 23:13:58.250 4420.0 561296.0 0.0 2015-11-23 23:13:58.500 4420.0 561296.0 0.0 2015-11-23 23:13:58.750 4420.0 561296.0 0.0 2015-11-23 23:13:59.000 4420.0 561304.0 8.0 2015-11-23 23:13:59.250 4420.0 561528.0 224.0 2015-11-23 23:13:59.500 4420.0 561528.0 0.0 2015-11-23 23:13:59.750 4422.0 561530.0 2.0 2015-11-23 23:14:00.000 4420.0 561550.0 20.0 2015-11-23 23:14:00.250 4420.0 561550.0 0.0 2015-11-23 23:14:00.500 4420.0 561552.0 2.0 2015-11-23 23:14:00.750 4420.0 561552.0 0.0 2015-11-23 23:14:01.000 4420.0 561552.0 0.0 2015-11-23 23:14:01.250 4422.0 561692.0 140.0 2015-11-23 23:14:01.500 4422.0 561692.0 0.0 2015-11-23 23:14:01.750 4422.0 561692.0 0.0 2015-11-23 23:14:02.000 4422.0 561692.0 0.0 2015-11-23 23:14:02.250 4422.0 561694.0 2.0 2015-11-23 23:14:02.500 4422.0 561694.0 0.0 2015-11-23 23:14:02.750 4422.0 561694.0 0.0 2015-11-23 23:14:03.000 4422.0 561714.0 20.0 2015-11-23 23:14:03.250 4420.0 561724.0 10.0 2015-11-23 23:14:03.500 4420.0 561736.0 12.0 2015-11-23 23:14:03.750 4420.0 561736.0 0.0 2015-11-23 23:14:04.000 4420.0 561736.0 0.0 2015-11-23 23:14:04.250 4420.0 561736.0 0.0 2015-11-23 23:14:04.500 4420.0 561736.0 0.0 2015-11-23 23:14:04.750 4420.0 561738.0 2.0 In [345]: % matplotlib inline In [297]: plt . plot ( vwap . index , ta . ix [ vwap . index , 'last' ]) plt . plot ( vwap . index , vwap ) Out[297]: [ ] In [270]: len ( vwap_indicator ) Out[270]: 2700120 In [271]: len ( ta_in_pm ) Out[271]: 1791180 In [272]: day_len * 20 Out[272]: 1800080 In [310]: day_len * 20 - len ( ta_in_pm ) Out[310]: 8900 In [242]: ( 200 + 44 ) * 20 Out[242]: 4880 In [303]: temp = vwap_indicator [ ta_in_pm . index ] In [307]: temp = temp . dropna () In [309]: ( vwap_indicator . isnull ()) . sum () Out[309]: 40 In [308]: len ( temp ) Out[308]: 1791180 In [284]: vwap , vwap_indicator = VWAPIndicator3 ( ta , 40 ) 0 1 1 40 In [ ]: y = pm [ xnew . index ] In [321]: % matplotlib inline In [48]: # -------------------------------------------- '''plot fit''' fig , ax = plt . subplots () fig = sm . graphics . plot_fit ( res , res . model . exog_names [ 1 ], ax = ax ) In [54]: vwap_indicator . hist ( bins = np . arange ( - 10.25 , 10.25 , . 5 )) Out[54]: In [35]: ta_pm = GiveMePM ( ta , n = 44 , lim = [ 0 , 30 ]) In [53]: vwap , vwap_indicator = VWAPIndicator4 ( ta , 240 ) vwap_indicator = vwap_indicator [ ta_pm . index ] In [57]: ta_pm . hist ( bins = np . arange ( - 50.5 , 50.5 , 1 )) Out[57]: Re check! In [185]: t11 , t22 = '2015-11-25 23:03:06.000' , '2015-11-25 23:03:12.000' In [186]: plt . plot ( ta . ix [ t11 : t22 , 'vol_diff' ]) #plt.ylim([0,3000]) Out[186]: [ ] In [183]: ta . ix [ t11 : t22 , [ 'last' , 'volume' , 'vol_diff' ]] Out[183]: last volume vol_diff 2015-11-25 22:03:06.000 1775.0 148528.0 0.0 2015-11-25 22:03:06.250 1775.0 148528.0 0.0 2015-11-25 22:03:06.500 1775.0 148528.0 0.0 2015-11-25 22:03:06.750 1775.0 148528.0 0.0 2015-11-25 22:03:07.000 1775.0 148528.0 0.0 2015-11-25 22:03:07.250 1775.0 148528.0 0.0 2015-11-25 22:03:07.500 1775.0 148528.0 0.0 2015-11-25 22:03:07.750 1775.0 148528.0 0.0 2015-11-25 22:03:08.000 1775.0 148528.0 0.0 2015-11-25 22:03:08.250 1775.0 148528.0 0.0 2015-11-25 22:03:08.500 1775.0 148528.0 0.0 2015-11-25 22:03:08.750 1775.0 148528.0 0.0 2015-11-25 22:03:09.000 1775.0 148528.0 0.0 2015-11-25 22:03:09.250 1775.0 148528.0 0.0 2015-11-25 22:03:09.500 1775.0 148528.0 0.0 2015-11-25 22:03:09.750 1775.0 148530.0 2.0 2015-11-25 22:03:10.000 1775.0 148530.0 0.0 2015-11-25 22:03:10.250 1775.0 148530.0 0.0 2015-11-25 22:03:10.500 1775.0 148530.0 0.0 2015-11-25 22:03:10.750 1775.0 148530.0 0.0 2015-11-25 22:03:11.000 1775.0 148530.0 0.0 2015-11-25 22:03:11.250 1775.0 148530.0 0.0 2015-11-25 22:03:11.500 1775.0 148530.0 0.0 2015-11-25 22:03:11.750 1775.0 148530.0 0.0 2015-11-25 22:03:12.000 1775.0 148530.0 0.0 2015-11-25 22:03:12.250 1775.0 148530.0 0.0 2015-11-25 22:03:12.500 1775.0 148530.0 0.0 2015-11-25 22:03:12.750 1775.0 148532.0 2.0 In [170]: vwap_indicator [ t11 : t22 ] Out[170]: 2015-12-01 11:03:06.000 0.0 2015-12-01 11:03:06.250 0.0 2015-12-01 11:03:06.500 0.0 2015-12-01 11:03:06.750 0.0 2015-12-01 11:03:07.000 0.0 2015-12-01 11:03:07.250 0.0 2015-12-01 11:03:07.500 0.0 2015-12-01 11:03:07.750 0.0 2015-12-01 11:03:08.000 0.0 2015-12-01 11:03:08.250 0.0 2015-12-01 11:03:08.500 0.0 2015-12-01 11:03:08.750 0.0 2015-12-01 11:03:09.000 0.0 2015-12-01 11:03:09.250 0.0 2015-12-01 11:03:09.500 0.0 2015-12-01 11:03:09.750 0.0 2015-12-01 11:03:10.000 0.0 2015-12-01 11:03:10.250 0.0 2015-12-01 11:03:10.500 0.0 2015-12-01 11:03:10.750 0.0 2015-12-01 11:03:11.000 0.0 2015-12-01 11:03:11.250 0.0 2015-12-01 11:03:11.500 0.0 2015-12-01 11:03:11.750 0.0 2015-12-01 11:03:12.000 0.0 2015-12-01 11:03:12.250 0.0 2015-12-01 11:03:12.500 0.0 2015-12-01 11:03:12.750 0.0 Name: vwap_indicator, dtype: float64 In [171]: vwap [ t11 : t22 ] Out[171]: 2015-12-01 11:03:06.000 1822.0 2015-12-01 11:03:06.250 1822.0 2015-12-01 11:03:06.500 1822.0 2015-12-01 11:03:06.750 1822.0 2015-12-01 11:03:07.000 1822.0 2015-12-01 11:03:07.250 1822.0 2015-12-01 11:03:07.500 1822.0 2015-12-01 11:03:07.750 1822.0 2015-12-01 11:03:08.000 1822.0 2015-12-01 11:03:08.250 1822.0 2015-12-01 11:03:08.500 1822.0 2015-12-01 11:03:08.750 1822.0 2015-12-01 11:03:09.000 1822.0 2015-12-01 11:03:09.250 1822.0 2015-12-01 11:03:09.500 1822.0 2015-12-01 11:03:09.750 1822.0 2015-12-01 11:03:10.000 1822.0 2015-12-01 11:03:10.250 1822.0 2015-12-01 11:03:10.500 1822.0 2015-12-01 11:03:10.750 1822.0 2015-12-01 11:03:11.000 1822.0 2015-12-01 11:03:11.250 1822.0 2015-12-01 11:03:11.500 1822.0 2015-12-01 11:03:11.750 1822.0 2015-12-01 11:03:12.000 1822.0 2015-12-01 11:03:12.250 1822.0 2015-12-01 11:03:12.500 1822.0 2015-12-01 11:03:12.750 1822.0 Name: vwaPrc, dtype: float64 In [247]: ta . ix [ '2015-11-19 21:00:55.000' : '2015-11-19 21:01:58.000' , 'last' ][: 55 ] Out[247]: 2015-11-19 21:00:55.000 4508.0 2015-11-19 21:00:55.250 4510.0 2015-11-19 21:00:55.500 4510.0 2015-11-19 21:00:55.750 4508.0 2015-11-19 21:00:56.000 4506.0 2015-11-19 21:00:56.250 4508.0 2015-11-19 21:00:56.500 4508.0 2015-11-19 21:00:56.750 4508.0 2015-11-19 21:00:57.000 4510.0 2015-11-19 21:00:57.250 4508.0 2015-11-19 21:00:57.500 4508.0 2015-11-19 21:00:57.750 4510.0 2015-11-19 21:00:58.000 4508.0 2015-11-19 21:00:58.250 4510.0 2015-11-19 21:00:58.500 4508.0 2015-11-19 21:00:58.750 4508.0 2015-11-19 21:00:59.000 4506.0 2015-11-19 21:00:59.250 4506.0 2015-11-19 21:00:59.500 4508.0 2015-11-19 21:00:59.750 4508.0 2015-11-19 21:01:00.000 4508.0 2015-11-19 21:01:00.250 4508.0 2015-11-19 21:01:00.500 4506.0 2015-11-19 21:01:00.750 4508.0 2015-11-19 21:01:01.000 4508.0 2015-11-19 21:01:01.250 4508.0 2015-11-19 21:01:01.500 4506.0 2015-11-19 21:01:01.750 4506.0 2015-11-19 21:01:02.000 4506.0 2015-11-19 21:01:02.250 4506.0 2015-11-19 21:01:02.500 4506.0 2015-11-19 21:01:02.750 4506.0 2015-11-19 21:01:03.000 4506.0 2015-11-19 21:01:03.250 4504.0 2015-11-19 21:01:03.500 4504.0 2015-11-19 21:01:03.750 4504.0 2015-11-19 21:01:04.000 4500.0 2015-11-19 21:01:04.250 4500.0 2015-11-19 21:01:04.500 4502.0 2015-11-19 21:01:04.750 4496.0 2015-11-19 21:01:05.000 4500.0 2015-11-19 21:01:05.250 4500.0 2015-11-19 21:01:05.500 4500.0 2015-11-19 21:01:05.750 4500.0 2015-11-19 21:01:06.000 4500.0 2015-11-19 21:01:06.250 4500.0 2015-11-19 21:01:06.500 4500.0 2015-11-19 21:01:06.750 4500.0 2015-11-19 21:01:07.000 4502.0 2015-11-19 21:01:07.250 4502.0 2015-11-19 21:01:07.500 4502.0 2015-11-19 21:01:07.750 4502.0 2015-11-19 21:01:08.000 4504.0 2015-11-19 21:01:08.250 4504.0 2015-11-19 21:01:08.500 4506.0 Name: last, dtype: float64 In [241]: ta_in_pm . ix [ '2015-11-19 21:00:55.000' : '2015-11-19 21:00:58.000' ] Out[241]: 2015-11-19 21:00:55.000 -6.0 2015-11-19 21:00:55.250 -8.0 2015-11-19 21:00:55.500 -6.0 2015-11-19 21:00:55.750 -4.0 2015-11-19 21:00:56.000 0.0 2015-11-19 21:00:56.250 -4.0 2015-11-19 21:00:56.500 -4.0 2015-11-19 21:00:56.750 0.0 2015-11-19 21:00:57.000 -6.0 2015-11-19 21:00:57.250 -6.0 2015-11-19 21:00:57.500 -6.0 2015-11-19 21:00:57.750 -8.0 2015-11-19 21:00:58.000 -4.0 2015-11-19 21:00:58.250 -6.0 2015-11-19 21:00:58.500 -4.0 2015-11-19 21:00:58.750 -6.0 Name: last, dtype: float64 In [197]: % matplotlib inline In [ ]: temp1 In [195]: vwap_indicator Out[195]: 2015-11-19 21:00:00.000 NaN 2015-11-19 21:00:00.250 NaN 2015-11-19 21:00:00.500 NaN 2015-11-19 21:00:00.750 NaN 2015-11-19 21:00:01.000 NaN 2015-11-19 21:00:01.250 NaN 2015-11-19 21:00:01.500 NaN 2015-11-19 21:00:01.750 NaN 2015-11-19 21:00:02.000 NaN 2015-11-19 21:00:02.250 NaN 2015-11-19 21:00:02.500 NaN 2015-11-19 21:00:02.750 NaN 2015-11-19 21:00:03.000 NaN 2015-11-19 21:00:03.250 NaN 2015-11-19 21:00:03.500 NaN 2015-11-19 21:00:03.750 NaN 2015-11-19 21:00:04.000 -0.937409 2015-11-19 21:00:04.250 0.060734 2015-11-19 21:00:04.500 -0.929339 2015-11-19 21:00:04.750 -0.714008 2015-11-19 21:00:05.000 0.297571 2015-11-19 21:00:05.250 -0.350000 2015-11-19 21:00:05.500 -0.332349 2015-11-19 21:00:05.750 -1.180602 2015-11-19 21:00:06.000 -0.941915 2015-11-19 21:00:06.250 -0.854938 2015-11-19 21:00:06.500 -0.824089 2015-11-19 21:00:06.750 -0.815873 2015-11-19 21:00:07.000 0.222222 2015-11-19 21:00:07.250 -0.748031 ... 2015-12-31 14:59:52.750 0.930693 2015-12-31 14:59:53.000 -0.069307 2015-12-31 14:59:53.250 -0.060000 2015-12-31 14:59:53.500 0.824561 2015-12-31 14:59:53.750 0.800000 2015-12-31 14:59:54.000 0.781250 2015-12-31 14:59:54.250 0.592593 2015-12-31 14:59:54.500 0.584906 2015-12-31 14:59:54.750 0.584906 2015-12-31 14:59:55.000 -0.365385 2015-12-31 14:59:55.250 0.473684 2015-12-31 14:59:55.500 0.444444 2015-12-31 14:59:55.750 -0.869565 2015-12-31 14:59:56.000 0.115385 2015-12-31 14:59:56.250 0.056604 2015-12-31 14:59:56.500 -0.909091 2015-12-31 14:59:56.750 -0.857143 2015-12-31 14:59:57.000 -0.607595 2015-12-31 14:59:57.250 -0.369231 2015-12-31 14:59:57.500 0.666667 2015-12-31 14:59:57.750 0.645669 2015-12-31 14:59:58.000 -0.348837 2015-12-31 14:59:58.250 0.656250 2015-12-31 14:59:58.500 0.656250 2015-12-31 14:59:58.750 0.656250 2015-12-31 14:59:59.000 0.585714 2015-12-31 14:59:59.250 -0.382550 2015-12-31 14:59:59.500 0.613333 2015-12-31 14:59:59.750 -0.389262 2015-12-31 15:00:00.000 -0.376712 Name: vwap_indicator2, dtype: float64 In [133]: ta_out_pm . plot () Out[133]: Black??? In [82]: for mywindow in [ 10 , 60 , 200 , 500 , 1000 , 2400 , 5000 , 10000 , 24000 ]: print ' \\n\\n\\n ---------------mywindow: %d ----------------------' % mywindow #mywindow = 2400 * 3 vol_roll = ta . ix [:, 'volume' ] . rolling ( window = mywindow ) last_multiply_vol = ta . ix [:, 'last' ] * ta . ix [:, 'volume' ] multi_roll = last_multiply_vol . rolling ( window = mywindow ) vwap = multi_roll . sum () * 1. / vol_roll . sum () vwap_indicator = vwap - ta . ix [:, 'last' ] # vwap_indicator.dropna(inplace=True) #------------------------------------------------------------------------------- ''' Automatically generate in and out sample data, then calculate Qty_indicator, then regression under different parameters ''' insample_index = list () for l in [[ 0 , 2 ], [ 4 , 6 ], [ 8 , 10 ], [ 14 , 16 ], [ 18 , 20 ], [ 22 , 24 ], [ 26 , 28 ]]: insample_index = insample_index + list ( range ( day_len * l [ 0 ], day_len * l [ 1 ])) outsample_index = list () for l in [[ 2 , 4 ], [ 6 , 8 ], [ 12 , 14 ], [ 16 , 18 ], [ 20 , 22 ], [ 24 , 26 ], [ 28 , 30 ]]: outsample_index = outsample_index + list ( range ( day_len * l [ 0 ], day_len * l [ 1 ])) for forward_ticks in range ( 50 , 52 , 2 ): ta_in_pm = GiveMePM ( ta , n = forward_ticks , lim = [ 0 , 20 ]) ta_out_pm = GiveMePM ( ta , n = forward_ticks , lim = [ 25 , 30 ]) res = myols ( vwap_indicator , ta_in_pm ) print ' \\n\\n\\n --------------------- %d ----------------------' % forward_ticks print res . summary () print ' \\n [OutSample R_SQUARE: %f ]' % ( PredictedRsquare ( res , vwap_indicator , ta_out_pm ))[ 1 ] ---------------mywindow: 10 ---------------------- --------------------- 50 ---------------------- OLS Regression Results ============================================================================== Dep. Variable: last R-squared: 0.106 Model: OLS Adj. R-squared: 0.106 Method: Least Squares F-statistic: 2.121e+05 Date: Thu, 14 Jul 2016 Prob (F-statistic): 0.00 Time: 07:41:41 Log-Likelihood: -3.5288e+06 No. Observations: 1793900 AIC: 7.058e+06 Df Residuals: 1793898 BIC: 7.058e+06 Df Model: 1 ============================================================================== coef std err t P>|t| [95.0% Conf. Int.] ------------------------------------------------------------------------------ const 0.0046 0.001 3.587 0.000 0.002 0.007 None 0.7456 0.002 460.545 0.000 0.742 0.749 ============================================================================== Omnibus: 507024.499 Durbin-Watson: 0.214 Prob(Omnibus): 0.000 Jarque-Bera (JB): 39368879.141 Skew: 0.415 Prob(JB): 0.00 Kurtosis: 25.935 Cond. No. 1.25 ============================================================================== [OutSample R_SQUARE: 0.122631] ---------------mywindow: 60 ---------------------- --------------------- 50 ---------------------- OLS Regression Results ============================================================================== Dep. Variable: last R-squared: 0.076 Model: OLS Adj. R-squared: 0.076 Method: Least Squares F-statistic: 1.472e+05 Date: Thu, 14 Jul 2016 Prob (F-statistic): 0.00 Time: 07:41:45 Log-Likelihood: -3.5583e+06 No. Observations: 1793900 AIC: 7.117e+06 Df Residuals: 1793898 BIC: 7.117e+06 Df Model: 1 ============================================================================== coef std err t P>|t| [95.0% Conf. Int.] ------------------------------------------------------------------------------ const 0.0057 0.001 4.365 0.000 0.003 0.008 None 0.4290 0.001 383.677 0.000 0.427 0.431 ============================================================================== Omnibus: 520812.501 Durbin-Watson: 0.250 Prob(Omnibus): 0.000 Jarque-Bera (JB): 39272475.183 Skew: 0.478 Prob(JB): 0.00 Kurtosis: 25.902 Cond. No. 1.17 ============================================================================== [OutSample R_SQUARE: 0.081837] ---------------mywindow: 200 ---------------------- --------------------- 50 ---------------------- OLS Regression Results ============================================================================== Dep. Variable: last R-squared: 0.023 Model: OLS Adj. R-squared: 0.023 Method: Least Squares F-statistic: 4.208e+04 Date: Thu, 14 Jul 2016 Prob (F-statistic): 0.00 Time: 07:41:49 Log-Likelihood: -3.6080e+06 No. Observations: 1793829 AIC: 7.216e+06 Df Residuals: 1793827 BIC: 7.216e+06 Df Model: 1 ============================================================================== coef std err t P>|t| [95.0% Conf. Int.] ------------------------------------------------------------------------------ const 0.0043 0.001 3.209 0.001 0.002 0.007 None 0.1336 0.001 205.131 0.000 0.132 0.135 ============================================================================== Omnibus: 472450.178 Durbin-Watson: 0.310 Prob(Omnibus): 0.000 Jarque-Bera (JB): 31917539.398 Skew: 0.334 Prob(JB): 0.00 Kurtosis: 23.654 Cond. No. 2.07 ============================================================================== [OutSample R_SQUARE: 0.013947] ---------------mywindow: 500 ---------------------- --------------------- 50 ---------------------- OLS Regression Results ============================================================================== Dep. Variable: last R-squared: 0.007 Model: OLS Adj. R-squared: 0.007 Method: Least Squares F-statistic: 1.320e+04 Date: Thu, 14 Jul 2016 Prob (F-statistic): 0.00 Time: 07:41:53 Log-Likelihood: -3.6213e+06 No. Observations: 1793529 AIC: 7.243e+06 Df Residuals: 1793527 BIC: 7.243e+06 Df Model: 1 ============================================================================== coef std err t P>|t| [95.0% Conf. Int.] ------------------------------------------------------------------------------ const 0.0031 0.001 2.247 0.025 0.000 0.006 None 0.0430 0.000 114.877 0.000 0.042 0.044 ============================================================================== Omnibus: 450416.004 Durbin-Watson: 0.334 Prob(Omnibus): 0.000 Jarque-Bera (JB): 26258295.086 Skew: 0.308 Prob(JB): 0.00 Kurtosis: 21.735 Cond. No. 3.64 ============================================================================== [OutSample R_SQUARE: 0.002693] ---------------mywindow: 1000 ---------------------- --------------------- 50 ---------------------- OLS Regression Results ============================================================================== Dep. Variable: last R-squared: 0.004 Model: OLS Adj. R-squared: 0.004 Method: Least Squares F-statistic: 7867. Date: Thu, 14 Jul 2016 Prob (F-statistic): 0.00 Time: 07:41:58 Log-Likelihood: -3.6223e+06 No. Observations: 1793029 AIC: 7.245e+06 Df Residuals: 1793027 BIC: 7.245e+06 Df Model: 1 ============================================================================== coef std err t P>|t| [95.0% Conf. Int.] ------------------------------------------------------------------------------ const 0.0028 0.001 2.069 0.039 0.000 0.005 None 0.0230 0.000 88.698 0.000 0.022 0.023 ============================================================================== Omnibus: 447160.915 Durbin-Watson: 0.339 Prob(Omnibus): 0.000 Jarque-Bera (JB): 24993957.951 Skew: 0.316 Prob(JB): 0.00 Kurtosis: 21.280 Cond. No. 5.26 ============================================================================== [OutSample R_SQUARE: 0.001277] ---------------mywindow: 2400 ---------------------- --------------------- 50 ---------------------- OLS Regression Results ============================================================================== Dep. Variable: last R-squared: 0.002 Model: OLS Adj. R-squared: 0.002 Method: Least Squares F-statistic: 4191. Date: Thu, 14 Jul 2016 Prob (F-statistic): 0.00 Time: 07:42:02 Log-Likelihood: -3.6211e+06 No. Observations: 1791629 AIC: 7.242e+06 Df Residuals: 1791627 BIC: 7.242e+06 Df Model: 1 ============================================================================== coef std err t P>|t| [95.0% Conf. Int.] ------------------------------------------------------------------------------ const 0.0023 0.001 1.703 0.089 -0.000 0.005 None 0.0111 0.000 64.737 0.000 0.011 0.011 ============================================================================== Omnibus: 444553.349 Durbin-Watson: 0.342 Prob(Omnibus): 0.000 Jarque-Bera (JB): 24377265.848 Skew: 0.315 Prob(JB): 0.00 Kurtosis: 21.060 Cond. No. 7.97 ============================================================================== [OutSample R_SQUARE: 0.000621] ---------------mywindow: 5000 ---------------------- --------------------- 50 ---------------------- OLS Regression Results ============================================================================== Dep. Variable: last R-squared: 0.001 Model: OLS Adj. R-squared: 0.001 Method: Least Squares F-statistic: 2268. Date: Thu, 14 Jul 2016 Prob (F-statistic): 0.00 Time: 07:42:07 Log-Likelihood: -3.6169e+06 No. Observations: 1789029 AIC: 7.234e+06 Df Residuals: 1789027 BIC: 7.234e+06 Df Model: 1 ============================================================================== coef std err t P>|t| [95.0% Conf. Int.] ------------------------------------------------------------------------------ const 0.0025 0.001 1.792 0.073 -0.000 0.005 None 0.0058 0.000 47.620 0.000 0.006 0.006 ============================================================================== Omnibus: 442249.583 Durbin-Watson: 0.343 Prob(Omnibus): 0.000 Jarque-Bera (JB): 23995176.643 Skew: 0.313 Prob(JB): 0.00 Kurtosis: 20.931 Cond. No. 11.3 ============================================================================== [OutSample R_SQUARE: 0.000328] ---------------mywindow: 10000 ---------------------- --------------------- 50 ---------------------- OLS Regression Results ============================================================================== Dep. Variable: last R-squared: 0.000 Model: OLS Adj. R-squared: 0.000 Method: Least Squares F-statistic: 842.0 Date: Thu, 14 Jul 2016 Prob (F-statistic): 4.43e-185 Time: 07:42:11 Log-Likelihood: -3.6082e+06 No. Observations: 1784029 AIC: 7.216e+06 Df Residuals: 1784027 BIC: 7.216e+06 Df Model: 1 ============================================================================== coef std err t P>|t| [95.0% Conf. Int.] ------------------------------------------------------------------------------ const 0.0026 0.001 1.877 0.060 -0.000 0.005 None 0.0025 8.6e-05 29.017 0.000 0.002 0.003 ============================================================================== Omnibus: 439920.805 Durbin-Watson: 0.344 Prob(Omnibus): 0.000 Jarque-Bera (JB): 23757886.879 Skew: 0.310 Prob(JB): 0.00 Kurtosis: 20.867 Cond. No. 16.0 ============================================================================== [OutSample R_SQUARE: 0.000128] ---------------mywindow: 24000 ---------------------- --------------------- 50 ---------------------- OLS Regression Results ============================================================================== Dep. Variable: last R-squared: 0.000 Model: OLS Adj. R-squared: 0.000 Method: Least Squares F-statistic: 475.2 Date: Thu, 14 Jul 2016 Prob (F-statistic): 2.44e-105 Time: 07:42:15 Log-Likelihood: -3.5825e+06 No. Observations: 1770029 AIC: 7.165e+06 Df Residuals: 1770027 BIC: 7.165e+06 Df Model: 1 ============================================================================== coef std err t P>|t| [95.0% Conf. Int.] ------------------------------------------------------------------------------ const 0.0018 0.001 1.324 0.185 -0.001 0.005 None 0.0012 5.67e-05 21.799 0.000 0.001 0.001 ============================================================================== Omnibus: 435736.170 Durbin-Watson: 0.344 Prob(Omnibus): 0.000 Jarque-Bera (JB): 23563592.016 Skew: 0.306 Prob(JB): 0.00 Kurtosis: 20.864 Cond. No. 24.4 ============================================================================== [OutSample R_SQUARE: 0.000081] In [ ]: if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) { var mathjaxscript = document.createElement('script'); mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#'; mathjaxscript.type = 'text/javascript'; mathjaxscript.src = '//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'; mathjaxscript[(window.opera ? \"innerHTML\" : \"text\")] = \"MathJax.Hub.Config({\" + \" config: ['MMLorHTML.js'],\" + \" TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },\" + \" jax: ['input/TeX','input/MathML','output/HTML-CSS'],\" + \" extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js'],\" + \" displayAlign: 'center',\" + \" displayIndent: '0em',\" + \" showMathMenu: true,\" + \" tex2jax: { \" + \" inlineMath: [ ['$','$'] ], \" + \" displayMath: [ ['$$','$$'] ],\" + \" processEscapes: true,\" + \" preview: 'TeX',\" + \" }, \" + \" 'HTML-CSS': { \" + \" styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'black ! important'} }\" + \" } \" + \"}); \"; (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript); }","tags":"quant","title":"Price Indicator Research"},{"url":"https://brillliantz.github.io/MySite/about-me/0.About.html","text":"I have so much passion for the beautiful world!","tags":"About Me","title":"About Me"}]}